function fetch(t,e){var i=this;return void 0===e&&(e={}),console.log(t,e),new Promise(function(r,n){var o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(t,e.method||egret.HttpMethod.GET),e.headers&&e.headers.forEach(function(t){o.setRequestHeader(t[0],t[1])});var s="";if(e.method===egret.HttpMethod.POST){var a=e.body||{};for(var h in a){var d=void 0;d="object"==typeof a[h]?JSON.stringify(a[h]):a[h],s+=h+"="+d+"&"}o.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}o.send(s),o.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=e.response,n={response:i,status:e._xhr.status,header:e.getAllResponseHeaders(),json:function(){return new Promise(function(t,e){return t(JSON.parse(i))})},text:function(){return new Promise(function(t,e){return t(i)})},blob:function(){return new Promise(function(t,e){var r=new Blob([JSON.stringify(JSON.parse(i),null,2)],{type:"application/json"});t(r)})}};r(n)},i)})}function drawText(){}function addChildren(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){t.addChild(e)})}function screenshot(t){var e=null;if(t instanceof egret.Texture&&(e=t),t instanceof egret.DisplayObject){var i=new egret.RenderTexture;i.drawToTexture(t),e=i}return{texture:e,toDataURL:function(t){void 0===t&&(t={});var i=t.area?new egret.Rectangle(t.area[0],t.area[1],t.area[2],t.area[3]):null;return e.toDataURL(t.format||"image/png",i)},toFile:function(t){void 0===t&&(t={});var i=t.area?new egret.Rectangle(t.area[0],t.area[1],t.area[2],t.area[3]):null;e.saveToFile(t.format,t.fileName||"download",i)}}}function loadImg(t){var e=this,i=new egret.ImageLoader;return new Promise(function(r,n){i.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=e.data,n=new egret.Bitmap(i);r(n)},e),i.load(t)})}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},View=function(t){function e(e){var i=t.call(this)||this;i.global=e,i.width=i.global.width,i.height=i.global.height,i.backBtn=new Button({width:60,height:60,x:10,y:10,background:Const.btnColor,text:{text:"<",style:{size:30}}}).on(egret.TouchEvent.TOUCH_END,function(t){i.global.main()},i),i.addChild(i.backBtn);var r=Draw.rect(null,{width:i.width,height:i.height}).brush({width:i.width,height:i.height,background:16777215});return i.addChildAt(r,0),i.addEventListener(AlertEvent.MSG,function(t){var e=new Button({y:i.height,width:i.width,height:60,background:4278190080,alpha:.4,text:{text:t.msg,style:{size:30,color:1048575}}}).center(!0,!1,i);e.alpha=0,i.addChild(e);var r=egret.Tween.get(e);r.to({y:-150,alpha:1},300,egret.Ease.backOut).wait(3e3).to({y:150,alpha:0},300,egret.Ease.backIn).call(function(){i.removeChild(e)})},i),i}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(View.prototype,"View");var Component=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.center=function(t,e,i,r){return void 0===r&&(r={x:0,y:0}),t&&(this.x=(i.width-this.width)/2+r.x),e&&(this.y=(i.height-this.height)/2+r.y),this},e.prototype.disable=function(){return this.alpha=.5,this.touchEnabled=!1,this},e.prototype.enable=function(){return this.alpha=1,this.touchEnabled=!0,this},e.prototype.on=function(t,e,i){return this.touchEnabled=!0,this.addEventListener(t,e,i),this},e}(egret.Sprite);__reflect(Component.prototype,"Component");var Button=function(t){function e(e){var i=t.call(this)||this;return i.width=e.width||200,i.height=e.height||100,i.init(e),i.cacheAsBitmap=!0,i.disabled=!1,i}return __extends(e,t),e.prototype.init=function(t){var e=this;this.addRect(t),t.img&&this.addImg(t),t.text&&this.addText(t),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.alpha=.8},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.alpha=1},this)},e.prototype.addRect=function(t){var e=Draw.rect(null,{x:t.x||0,y:t.y||0,width:this.width,height:this.height,rotation:t.rotation||0,alpha:t.alpha||1}).brush({width:this.width||0,height:this.height||0,background:t.background||0});this.addChild(e)},e.prototype.addImg=function(t){var e=this.img=new egret.Bitmap;e.texture=RES.getRes(t.img),e.width=this.width,e.height=this.height,this.addChild(e)},e.prototype.addText=function(t){t.text.style=t.text.style||{};var e=this.text=Draw.text(t.text.text,{x:t.x||0,y:t.y||0,width:this.width,height:this.height,textColor:t.text.style.textColor||16777215,size:t.text.style.size||20,textAlign:egret.HorizontalAlign.CENTER,verticalAlign:egret.VerticalAlign.MIDDLE});e.cacheAsBitmap=!0,this.addChild(e)},e.prototype.update=function(t){return console.log(t.text),this.text.text=t.text,this},e}(Component);__reflect(Button.prototype,"Button");var Const=function(){function t(){}return t}();Const.gameName="Tenrun",Const.btnColor=11755561,Const.mainColor=15582561,__reflect(Const.prototype,"Const");var Input=function(t){function e(e){var i=t.call(this)||this;Object.assign(i,e);var r=e.inputStyle.width||400,n=e.inputStyle.height||40;return Array.isArray(e.padding)?(i.width=r+e.padding[1]+e.padding[3],i.height=n+e.padding[0]+e.padding[2]):(i.width=r+2*e.padding,i.height=n+2*e.padding),i.inputStyle=Object.assign({},e.inputStyle),i.addChild(i.createBg()),i.input=i.createInput(),i.addChild(i.input),i}return __extends(e,t),e.prototype.createInput=function(){var t=new egret.TextField,e=this.inputStyle,i={x:0,y:0};return Array.isArray(this.padding)?(i.x=this.padding[3],i.y=this.padding[0]):i.x=i.y=this.padding,console.log(i),Object.assign(t,{type:e.type||egret.TextFieldType.INPUT,width:e.width||400,height:e.height||40,x:i.x,y:i.y,textColor:e.textColor||4278190080}),t},e.prototype.createBg=function(){var t=Draw.rect(null,{width:this.width,height:this.height}).brush({background:this.background,width:this.width,height:this.height});return t},Object.defineProperty(e.prototype,"input",{get:function(){return this._input},set:function(t){this._input=t},enumerable:!0,configurable:!0}),e.prototype.setFocus=function(){this.input.setFocus()},e}(Component);__reflect(Input.prototype,"Input");var AlertEvent=function(t){function e(e,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=t.call(this,e,i,r)||this;return n.msg="",n}return __extends(e,t),e}(egret.Event);AlertEvent.MSG="msg",AlertEvent.WARNING="warning",AlertEvent.ERROR="error",__reflect(AlertEvent.prototype,"AlertEvent");var GameView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.horizontalLine=200,n.score=0,n.figurePoint={x:200,y:370},n.figureRectPoint={x:150,y:290},n.figureRectOffset={x:n.figurePoint.x-n.figureRectPoint.x,y:n.figurePoint.y-n.figureRectPoint.y},n.isFalling=!1,n.isPause=!1,n.jumpCounter=-22,n.fallCounter=0,n.speed=0,n.global=e,n.init(),n}return __extends(e,t),e.prototype.init=function(){function t(){return r=this.hitTest(this.figureRect,this.obstacle),r&&("ON"===localStorage.getItem("music")&&(this.overbg=RES.getRes("hit"),o=this.overbg.play(0,1),n&&n.stop()),egret.stopTick(t,this),this.gameover()),!1}function e(){requestAnimationFrame(e),s.step(.06),c.x=h.position[0],c.y=h.position[1]}var i=this;this.createLand(),this.addChild(this.land),this.createSand(),this.addChild(this.sand),this.loadFigure(),this.addChild(this.figure),this.addChild(this.figureRect),this.pauseBtn=new Button({width:120,height:60,x:80,y:10,background:Const.btnColor,text:{text:"Pause",style:{size:30}}}).on(egret.TouchEvent.TOUCH_BEGIN,function(t){t.stopPropagation(),i.isPause?(i.play(),i.isPause=!1,i.pauseBtn.update({text:"Pause"})):(i.pause(),i.isPause=!0,i.pauseBtn.update({text:"Play"}))},this),this.addChild(this.pauseBtn),this.scoreText=new egret.TextField,this.scoreText.text=this.score+"",this.scoreText.textColor=Const.btnColor,this.scoreText.width=400,this.scoreText.size=40,this.scoreText.x=this.width-this.scoreText.width-20,this.scoreText.y=20,this.scoreText.textAlign=egret.HorizontalAlign.RIGHT,this.addChild(this.scoreText);var r=!1;this.bg=RES.getRes("bg");var n,o;"ON"===localStorage.getItem("music")&&(n=this.bg.play(0,-1),n.volume=.2),egret.startTick(t,this),this.backBtn.on(egret.TouchEvent.TOUCH_END,function(){o&&o.stop(),n&&n.stop(),egret.stopTick(t,i)},this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.jump,this,!0),this.addEventListener(egret.TouchEvent.TOUCH_END,this.falling,this,!0),this.touchEnabled=!0,this.createObstacle(),this.addChild(this.obstacle);var s=new p2.World;s.sleepMode=p2.World.BODY_SLEEPING,s.gravity=[0,100];var a=new p2.Box({width:200,height:100}),h=new p2.Body({mass:10,position:[200,3],angle:45});h.addShape(a),s.addBody(h);var d=new p2DebugDraw(s),l=new egret.Sprite;this.addChild(l),d.setSprite(l);var c=new Button({x:h.position[0],y:h.position[1],width:300,height:80,background:Const.btnColor,text:{text:"Game start",style:{textColor:16777215,size:50}}});if(this.addChild(c),e(),!localStorage.getItem("gameTutorialed")){var u=new AlertEvent(AlertEvent.MSG,!0);u.msg="长按跳跃，跳跃高度与长按时间有关",this.dispatchEvent(u),localStorage.setItem("gameTutorialed","true"),this.pause(),setTimeout(function(){i.play()},3e3)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,console.log(i),e},e.prototype.createSand=function(){var t=RES.getRes("sand_png"),e=RES.getRes("sand_json");this.sand=new particle.GravityParticleSystem(t,e),this.sand.x=-280},e.prototype.createLand=function(){this.land=Draw.rect(null,{width:this.width,height:this.horizontalLine,y:this.height-this.horizontalLine}).brush({width:this.width,height:this.horizontalLine,background:Const.mainColor})},e.prototype.createScore=function(){this.scoreText=Draw.text("0",{x:this.width-200,y:20,width:300,height:40,size:40,textAlign:egret.HorizontalAlign.RIGHT,textColor:Const.mainColor}),console.log(this.score)},e.prototype.loadFigure=function(){var t=RES.getRes("Tenrun_ske_json"),e=RES.getRes("tenrun"),i=RES.getRes("tenrun_texture"),r=new dragonBones.EgretFactory;r.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(t)),r.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,e)),this.figure=r.buildArmatureDisplay("Tenrun"),this.figure.x=this.figurePoint.x,this.figure.y=this.figurePoint.y,this.figure.scaleX=-.3,this.figure.scaleY=.3,this.figure.animation.timeScale=2,this.figure.animation.play("run",0),this.figureRect=Draw.rect(null,{x:this.figureRectPoint.x,y:this.figureRectPoint.y,width:100,height:160,alpha:.4}).brush({width:100,height:160,background:15658734})},e.prototype.jump=function(t){var e=this;this.isFalling||t.target===this.pauseBtn||(this.figure.animation.gotoAndStop("run",1),this.jumpTimer=setInterval(function(){if(!e.isPause){if(0===e.jumpCounter)return clearInterval(e.jumpTimer),void e.falling(t);e.figure.y=e.caculateHeight(e.jumpCounter++),e.figureRect.y=e.figure.y-e.figureRectOffset.y}},20))},e.prototype.falling=function(t){var e=this;t.target!==this.pauseBtn&&(clearInterval(this.jumpTimer),this.fallCounter=-this.jumpCounter,this.jumpCounter=-22,this.isFalling=!0,this.touchEnabled=!1,this.fallTimer=setInterval(function(){if(!e.isPause){if(e.fallCounter>=22)return e.fallCounter=0,e.isFalling=!1,e.touchEnabled=!0,clearInterval(e.fallTimer),e.figure.animation.play("run",0),e.sand.start(),void setTimeout(function(){e.sand.stop()},200);e.figure.y=e.caculateHeight(e.fallCounter++),e.figureRect.y=e.figure.y-e.figureRectOffset.y}},20))},e.prototype.caculateHeight=function(t){return.5*Math.pow(t,2)+150},e.prototype.createObstacle=function(){var t=this,e=this.randomHeight(100,195);this.obstacle=Draw.rect(this.obstacle?this.obstacle:null,{width:60,height:e,x:this.width,y:this.height-this.horizontalLine-e+20}).brush({background:Const.mainColor}),this.tw=egret.Tween.get(this.obstacle),this.tw.to({x:-100},2e3-this.speed).call(function(){t.score+=100,t.scoreText.text=t.score+"",t.createObstacle()}),this.speed<=1e3&&(this.speed+=10)},e.prototype.randomHeight=function(t,e){return Math.random()*(e-t)+t},e.prototype.hitTest=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x,r.y=e.y,i.intersects(r)},e.prototype.pause=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.jump,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.falling,this),this.tw.setPaused(!0),this.figure.animation.stop("run")},e.prototype.play=function(){this.tw.setPaused(!1),this.figure.animation.play()},e.prototype.gameover=function(){var t=this;egret.Tween.removeAllTweens(),clearInterval(this.jumpTimer),clearInterval(this.fallTimer),this.touchEnabled=!1;var e=Draw.rect(null,{width:this.width,height:this.height,alpha:.8}).brush({background:4278190080});e.touchEnabled=!0,this.addChild(e);var i=new Button({width:200,height:100,background:Const.btnColor,text:{text:"Retry",style:{size:50}}}).on(egret.TouchEvent.TOUCH_END,function(e){t.global.game()},this).center(!0,!0,this,{x:-100,y:0});this.addChild(i);var r=new Button({width:200,height:100,background:Const.btnColor,text:{text:"Home",style:{size:50}}}).on(egret.TouchEvent.TOUCH_END,function(e){t.global.main()},this).center(!0,!0,this,{x:100,y:0});this.addChild(r);var n=egret.localStorage,o=n.getItem("username");fetch("https://node.geeku.net/tenrun/score",{method:egret.HttpMethod.POST,body:{name:o,score:this.score}}).then(function(t){console.log(t)})},e}(View);__reflect(GameView.prototype,"GameView");var Brush=function(){function t(t,e){this.sprite=t,this.type=e}return t.prototype.brush=function(t){switch(this.type){case"rect":this.brushRect(t)}return this.sprite},t.prototype.brushRect=function(t){t.background&&this.sprite.graphics.beginFill(t.background),t.lineWidth&&t.lineColor&&this.sprite.graphics.lineStyle(t.lineWidth,t.lineColor);var e=this.sprite.height||t.height||0,i=this.sprite.width||t.width||0;this.sprite.graphics.drawRect(t.x||0,t.y||0,i,e),this.sprite.graphics.endFill()},t}();__reflect(Brush.prototype,"Brush");var Draw=function(){function t(){}return t.rect=function(t,e){t=t||new egret.Sprite;var i={x:0,y:0,width:0,height:0,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,alpha:1};e.scrollRect&&(t.scrollRect=e.scrollRect,t.cacheAsBitmap=!0);var r=Object.assign(i,e);return Object.assign(t,r),new Brush(t,"rect")},t.circle=function(t){return void 0===t&&(t=new egret.Sprite),new Brush(t,"circle")},t.line=function(t){return void 0===t&&(t=new egret.Sprite),new Brush(t,"line")},t.text=function(t,e){void 0===e&&(e={});var i=new egret.TextField;"textFlow"in e&&(i.textFlow=e.textFlow),i.text=t;for(var r in e)i[r]=e[r];return i},t.container=function(){},t}();__reflect(Draw.prototype,"Draw");var RankList=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.complete,e),e.skinName="resource/rank.exml",e}return __extends(e,t),e.prototype.complete=function(){var t=[{index:"",name:"加载中",score:""}];this.rankList.dataProvider=new eui.ArrayCollection(t),this.rankList.itemRenderer=RankItem},e.prototype.updateData=function(t){this.rankList.dataProvider=new eui.ArrayCollection(t),this.rankList.itemRenderer=RankItem},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e}(eui.Component);__reflect(RankList.prototype,"RankList");var RankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/rankItem.exml",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e}(eui.ItemRenderer);__reflect(RankItem.prototype,"RankItem");var RankView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.init(),n}return __extends(e,t),e.prototype.init=function(){this.addChildAt(this.bg(),1),this.scroll()},e.prototype.bg=function(){return Draw.rect(null,{width:this.width,height:this.height}).brush({background:Const.mainColor})},e.prototype.scroll=function(){var t=Draw.rect(null,{width:840,height:440,x:148,y:142}).brush({background:Const.btnColor});this.addChild(t);var e=new RankList;this.addChild(e),fetch("https://node.geeku.net/tenrun/score").then(function(t){return t.json()}).then(function(t){var i=[],r=1;t.forEach(function(t){console.log(t),i.push({index:r+"",name:t.name,score:t.score+""}),r++}),e.updateData(i)})},e}(View);__reflect(RankView.prototype,"RankView");var StartView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.global=e,n.removeChild(n.backBtn),n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("start_bg"),this.addChildAt(t,1);var e=egret.localStorage,i=e.getItem("username");this.btns=this.addBtns(),e.getItem("music")||e.setItem("music","ON"),i?this.setTutorial():this.register()},e.prototype.setTutorial=function(){var t=this;localStorage.getItem("tutorial")?this.btns.forEach(function(t){t.enable()}):this.tutorial(this.btns[0],function(){t.tutorial(t.btns[1],function(){t.tutorial(t.btns[2],function(){localStorage.setItem("tutorial","true"),t.btns.forEach(function(t){t.enable()})})})})},e.prototype.addBtns=function(){var t=this,e=200,i=new Button({width:200,height:100,background:Const.btnColor,text:{text:"Start",style:{size:50}}}).on(egret.TouchEvent.TOUCH_END,function(e){t.global.game()},this).center(!0,!0,this,{x:0,y:e}).disable();this.addChild(i);var r=new Button({width:120,height:100,background:Const.btnColor,text:{text:"Rank",style:{size:30}}}).center(!0,!0,this,{x:-170,y:e}).on(egret.TouchEvent.TOUCH_END,function(){t.global.rank()},this).disable();this.addChild(r);var n=new Button({width:120,height:100,background:Const.btnColor,text:{text:"♫ "+(localStorage.getItem("music")||"ON"),style:{size:30}}}).center(!0,!0,this,{x:170,y:e}).on(egret.TouchEvent.TOUCH_END,function(){var t="ON"===localStorage.getItem("music")?"OFF":"ON";n.update({text:"♫ "+t}),localStorage.setItem("music",t)},this).disable();return this.addChild(n),[n,r,i]},e.prototype.tutorial=function(t,e){var i=this;void 0===e&&(e=function(){});var r=new Mask(t,this,{alpha:.8});this.addChildAt(r,9999);var n=new Button({width:200,x:this.width-250,text:{text:"Next",style:{size:40}}}).on(egret.TouchEvent.TOUCH_END,function(){i.removeChild(r),i.removeChild(n),e()},this);this.addChildAt(n,9999)},e.prototype.register=function(){var t=this,e=Draw.rect(null,{width:this.width,height:this.height,alpha:.8}).brush({width:this.width,height:this.height,background:4278190080});this.addChild(e);var i;i=new Input({background:8930338,padding:20,inputStyle:{width:400,height:40,textColor:16777215}}).center(!0,!1,this),this.addChild(i),i.setFocus();var r=new Button({width:200,height:80,background:11755561,y:80,text:{text:"Submit",style:{size:30}}}).on(egret.TouchEvent.TOUCH_END,function(n){if(console.log(i.input.text),!i.input.text){var o=new AlertEvent(AlertEvent.MSG,!0);return o.msg="Username cannot be empty",t.dispatchEvent(o),void console.log(o)}localStorage.setItem("username",i.input.text),t.removeChild(r),t.removeChild(i),t.removeChild(e),t.setTutorial()},this).center(!0,!1,this,{x:0,y:0});this.addChild(r)},e}(View);__reflect(StartView.prototype,"StartView");var Mask=function(t){function e(e,i,r){var n=t.call(this)||this;return n.maskChunks=[],n.hole=e,n.context=i,r=r||{},n.gap=r.gap||10,n.background=r.background||4278190080,n.alpha=r.alpha||.8,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=this;this.maskChunks.push(Draw.rect(null,{width:this.context.width,height:this.hole.y-this.gap}).brush({background:this.background})),this.maskChunks.push(Draw.rect(null,{x:this.hole.x+this.hole.width+this.gap,y:this.hole.y-this.gap,width:this.context.width-this.hole.x-this.hole.width-this.gap,height:this.hole.height+2*this.gap}).brush({background:this.background})),this.maskChunks.push(Draw.rect(null,{y:this.hole.y+this.hole.height+this.gap,width:this.context.width,height:this.context.height-this.hole.y-this.hole.height-this.gap}).brush({background:this.background})),this.maskChunks.push(Draw.rect(null,{y:this.hole.y-this.gap,width:this.hole.x-this.gap,height:this.hole.height+2*this.gap}).brush({background:this.background})),this.maskChunks.forEach(function(e){e.touchEnabled=!0,t.addChild(e)})},e}(egret.DisplayObjectContainer);__reflect(Mask.prototype,"Mask");var p2DebugDraw=function(){function t(t){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.world=t}return t.prototype.setSprite=function(t){this.sprite=t},t.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var t=this.world.bodies.length,e=0;t>e;e++)for(var i=this.world.bodies[e],r=0;r<i.shapes.length;r++){var n=i.shapes[r];this.drawShape(n,i),this.isDrawAABB&&this.drawAABB(i)}t=this.world.constraints.length;for(var o,r=0;t>r;r++)switch(o=this.world.constraints[r],o.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(o);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(o);break;case p2.Constraint.GEAR:this.drawGearJoint(o);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(o);break;case p2.Constraint.LOCK:this.drawLockJoint(o)}t=this.world.springs.length;for(var s,a=0;t>a;a++)s=this.world.springs[a],s instanceof p2.LinearSpring?this.drawLinearSpring(s):s instanceof p2.RotationalSpring&&this.drawRotationalSpring(s)},t.prototype.drawAABB=function(t){var e=new Array,i=t.aabb.lowerBound[0],r=t.aabb.lowerBound[1],n=t.aabb.upperBound[0],o=t.aabb.upperBound[1];isFinite(i)&&isFinite(r)&&isFinite(n)&&isFinite(o)&&(e.push([i,r],[n,r],[n,o],[i,o]),this.drawConvex(e,this.COLOR_S,1,!1))},t.prototype.drawDistanceJoint=function(t){var e,i=new Array,r=new Array;e=t.distance,t.upperLimitEnabled&&t.upperLimit>e&&(e=t.upperLimit),t.bodyA.toWorldFrame(i,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var n=p2.vec2.subtract([],r,i);p2.vec2.normalize(n,n),p2.vec2.scale(n,n,e);var o=p2.vec2.add([],i,n);this.drawSegment(i,t.bodyA.position,this.COLOR_S),this.drawSegment(r,t.bodyB.position,this.COLOR_S),this.drawVecAt(n,i,this.COLOR_BLACK),t.position>e&&this.drawSegment(r,o,this.COLOR_RED),this.drawCircle(i,3,this.COLOR_BLACK),this.drawCircle(o,3,this.COLOR_BLACK),t.lowerLimitEnabled&&(p2.vec2.normalize(n,n),p2.vec2.scale(n,n,t.lowerLimit),o=p2.vec2.add([],i,n),this.drawCircle(o,2,this.COLOR_BLACK))},t.prototype.drawRevoluteJoint=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.pivotA),t.bodyB.toWorldFrame(i,t.pivotB),this.drawSegment(t.bodyA.position,e,this.COLOR_S),this.drawSegment(t.bodyB.position,i,this.COLOR_S),this.drawSegment(e,i,this.COLOR_RED),this.drawCircle(e,3,this.COLOR_BLACK)},t.prototype.drawGearJoint=function(t){var e=t.bodyA.position,i=t.bodyB.position,r=new Array,n=new Array;t.bodyA.toWorldFrame(r,[20,0]),t.bodyB.toWorldFrame(n,[20,0]);var o=p2.vec2.subtract([],e,r),s=p2.vec2.subtract([],i,n);this.drawVecAt(o,e,this.COLOR_BLACK,!0),this.drawVecAt(s,i,this.COLOR_BLACK,!0),t.bodyB.toWorldFrame(s,[10*(t.bodyB.angle-t.bodyA.angle-t.angle),0]),this.drawSegment(s,i,this.COLOR_RED)},t.prototype.drawPrismaticJoint=function(t){var e=(t.bodyA.position,t.bodyB.position,new Array),i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=new Array;r=this.toWorldVector(t.localAxisA,t.bodyA);var n=p2.vec2.copy([],r),o=p2.vec2.copy([],r);t.lowerLimitEnabled?p2.vec2.scale(n,r,t.lowerLimit):p2.vec2.scale(n,r,5e3),t.upperLimitEnabled?p2.vec2.scale(o,r,t.upperLimit):p2.vec2.scale(o,r,5e3),this.drawVecAt(n,e,this.COLOR_BLACK,!0),this.drawVecAt(o,e,this.COLOR_BLACK,!0),p2.vec2.add(n,n,e),this.drawCircle(n,2,this.COLOR_BLACK,1,!0),p2.vec2.add(o,o,e),this.drawCircle(o,2,this.COLOR_BLACK,1,!0)},t.prototype.drawLockJoint=function(t){var e=new Array;new Array;t.bodyA.toWorldFrame(e,t.localOffsetB),this.drawSegment(e,t.bodyA.position,this.COLOR_S),this.drawSegment(e,t.bodyB.position,this.COLOR_RED),this.drawCircle(e,3,this.COLOR_BLACK);var i=new Array;t.bodyA.toWorldFrame(i,[20,0]),this.drawSegment(i,t.bodyA.position,this.COLOR_BLACK),t.bodyB.toWorldFrame(i,[20,0]),this.drawSegment(i,t.bodyB.position,this.COLOR_BLACK)},t.prototype.drawLinearSpring=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=p2.vec2.subtract([],i,e);p2.vec2.normalize(r,r),p2.vec2.scale(r,r,t.restLength);var n=p2.vec2.add([],t.bodyA.position,r);this.drawSegment(n,t.bodyB.position,this.COLOR_RED),this.drawVecAt(r,e,this.COLOR_BLACK),this.drawCircle(e,3,this.COLOR_RED),this.drawCircle(n,3,this.COLOR_RED)},t.prototype.drawRotationalSpring=function(t){var e=new Array,i=new Array;e=t.bodyA.position,i=t.bodyB.position;var r=new Array,n=new Array;t.bodyA.toWorldFrame(r,[20,0]),t.bodyB.toWorldFrame(n,[10*(t.bodyB.angle-t.bodyA.angle-t.restAngle+2),0]);var o=p2.vec2.subtract([],r,e),s=p2.vec2.subtract([],n,i);this.drawVecAt(o,e,this.COLOR_RED,!0),this.drawVecAt(s,i,this.COLOR_RED,!0),t.bodyB.toWorldFrame(n,[20,0]),this.drawCircle(r,2,this.COLOR_RED),this.drawCircle(n,2,this.COLOR_RED)},t.prototype.drawShape=function(t,e,i,r){var i=void 0==i?this.getColor(e):i,r=void 0==r?!0:r;t instanceof p2.Convex?this.drawConvexShape(t,e,i,r):t instanceof p2.Plane?this.drawPlaneShape(t,e,i,r):t instanceof p2.Circle?this.drawCircleShape(t,e,i,r):t instanceof p2.Capsule?this.drawCapsule(t,e,i):t instanceof p2.Particle?this.drawParticle(t,e,i):t instanceof p2.Line?this.drawLine(t,e,i):t instanceof p2.Heightfield&&this.drawHeightfeild(t,e,i)},t.prototype.drawConvexShape=function(t,e,i,r){var n=(e.shapes.indexOf(t),t.position),o=t.angle,s=[],a=this.transformVec(t.vertices[0],n,o);e.toWorldFrame(s,n),e.toWorldFrame(a,a),this.drawSegment(s,a,i);for(var h=new Array,d=t.vertices.length,l=0;d>l;l++)a=this.transformVec(t.vertices[l],n,o),e.toWorldFrame(a,a),h.push(a);this.drawConvex(h,i,.5,r)},t.prototype.drawParticle=function(t,e,i){this.drawCircle(e.position,1,i,.5),this.drawCircle(e.position,5,i,1,!1)},t.prototype.drawLine=function(t,e,i){var r=t.length,n=new Array,o=new Array;e.toWorldFrame(n,[-r/2,0]),e.toWorldFrame(o,[r/2,0]),this.drawSegment(n,o,i)},t.prototype.drawHeightfeild=function(t,e,i){var r=this.sprite.graphics;r.lineStyle(1,i),r.beginFill(i,.5);var n,o=t.heights,s=t.elementWidth,a=new Array,h=new Array;o.forEach(function(t,i){n=i*s,a=new Array,e.toWorldFrame(a,[n,t]),h.push(a)}),a=new Array,e.toWorldFrame(a,[n,-500]),h.push(a),a=new Array,e.toWorldFrame(a,[0,-500]),h.push(a),a=new Array,e.toWorldFrame(a,[0,0]),h.push(a),this.drawConvex(h,i,.5)},t.prototype.drawCapsule=function(t,e,i){var r=t.length,n=t.radius,o=new Array,s=new Array,a=new Array,h=new Array,d=new Array,l=new Array;e.toWorldFrame(o,[-r/2,-n]),e.toWorldFrame(s,[r/2,-n]),e.toWorldFrame(a,[r/2,n]),e.toWorldFrame(h,[-r/2,n]),e.toWorldFrame(d,[r/2,0]),e.toWorldFrame(l,[-r/2,0]),this.drawCircle(d,n,i,.5),this.drawCircle(l,n,i,.5),this.drawConvex([o,s,a,h],i,.5)},t.prototype.drawCircleShape=function(t,e,i,r){var n=t.position,o=t.angle,s=new Array;e.toWorldFrame(s,n),this.drawCircle(s,t.radius,i,.5,r);var a=this.transformVec([t.radius,0],n,o);e.toWorldFrame(a,a),this.drawSegment(s,a,i)},t.prototype.drawPlaneShape=function(t,e,i,r){var n=new Array,o=new Array;e.shapes.indexOf(t);e.toWorldFrame(n,[1e3,0]),n=this.transformVec(n,t.position,t.angle),o.push(n),n=new Array,e.toWorldFrame(n,[1e3,-1e3]),n=this.transformVec(n,t.position,t.angle),o.push(n),n=new Array,e.toWorldFrame(n,[-1e3,-1e3]),n=this.transformVec(n,t.position,t.angle),o.push(n),n=new Array,e.toWorldFrame(n,[-1e3,0]),n=this.transformVec(n,t.position,t.angle),o.push(n),this.drawConvex(o,i,.5,r)},t.prototype.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},t.prototype.drawVecAt=function(t,e,i,r){void 0===r&&(r=!1);var n=p2.vec2.copy([],e),o=p2.vec2.add([],t,e);r&&this.drawCircle(n,3,i),this.drawSegment(n,o,i)},t.prototype.drawVecTo=function(t,e,i,r){void 0===r&&(r=!1);var n=p2.vec2.copy([],e),o=p2.vec2.subtract([],e,t);r&&this.drawCircle(n,3,i),this.drawSegment(n,o,i)},t.prototype.drawSegment=function(t,e,i){this.sprite.graphics.lineStyle(1,i),this.sprite.graphics.moveTo(t[0],t[1]),this.sprite.graphics.lineTo(e[0],e[1])},t.prototype.drawCircle=function(t,e,i,r,n){void 0===r&&(r=1),this.sprite.graphics.lineStyle(1,i),(n||void 0==n)&&this.sprite.graphics.beginFill(i,r),this.sprite.graphics.drawCircle(t[0],t[1],e),this.sprite.graphics.endFill()},t.prototype.drawConvex=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),this.sprite.graphics.lineStyle(1,e),r&&this.sprite.graphics.beginFill(e,i);var n=t.length,o=t[0];this.sprite.graphics.moveTo(o[0],o[1]);for(var s=1;n>=s;s++)o=t[s%n],this.sprite.graphics.lineTo(o[0],o[1]);this.sprite.graphics.endFill()},t.prototype.toWorldVector=function(t,e){var i=new Array;return p2.vec2.rotate(i,t,e.angle),i},t.prototype.transformVec=function(t,e,i){var r=new Array;return p2.vec2.rotate(r,t,i),p2.vec2.add(r,r,e),r},t}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");var Loading=function(t){function e(e){var i=t.call(this)||this;return i.bgUrl="resource/assets/Artboard.png",i.global=e,i.createView(),i}return __extends(e,t),e.prototype.createView=function(){this.w=this.global.width,this.h=this.global.height,this.textField=new egret.TextField,this.textField.y=500,this.textField.textColor=3355443,this.textField.size=23,this.textField.width=this.w,this.textField.height=100,this.textField.fontFamily="Black",this.textField.textAlign="center",this.textField_power=new egret.TextField,this.textField_power.y=.9*this.h,this.textField_power.textColor=3355443,this.textField_power.width=this.w,this.textField_power.height=100,this.textField_power.size=20,this.textField_power.text="Powered by Egret Engine",this.textField_power.fontFamily="Black",this.textField_power.textAlign="center";var t=new egret.URLLoader;t.addEventListener(egret.Event.COMPLETE,this.onComplete,this),t.dataFormat=egret.URLLoaderDataFormat.TEXTURE,t.load(new egret.URLRequest(this.bgUrl)),this.bg=new egret.Bitmap,this.uiContainer=new egret.DisplayObjectContainer,this.addChild(this.uiContainer),this.addChildAt(this.bg,0),this.addChild(this.textField),this.addChild(this.textField_power)},e.prototype.onComplete=function(t){var e=t.target,i=e.data;e._request.url==this.bgUrl&&(this.bg.texture=i,this.bg.scaleX=this.w/640,this.bg.scaleY=this.h/960)},e.prototype.setProgress=function(t,e){var i=Math.floor(t/e*100);this.textField.text="游戏加载中…"+i+"%"},e.prototype.onLoadComplete=function(t,e){t.call(e)},e}(egret.Sprite);__reflect(Loading.prototype,"Loading");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.loadingView=new Loading(this),this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.main())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")
},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.main=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new StartView(this,this.width,this.height);this.addChild(t)},e.prototype.game=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new GameView(this,this.width,this.height);this.addChild(t)},e.prototype.rank=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new RankView(this,this.width,this.height);this.addChild(t)},e.prototype.clear=function(){this.removeChildren()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");