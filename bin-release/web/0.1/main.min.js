function drawText(){}function fetch(t,e){var i=this;return void 0===e&&(e={}),console.log(t,e),new Promise(function(r,n){var o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(t,e.method||egret.HttpMethod.GET),e.headers&&e.headers.forEach(function(t){o.setRequestHeader(t[0],t[1])});var s="";if(e.method===egret.HttpMethod.POST){var h=e.body||{};for(var a in h){var d=void 0;d="object"==typeof h[a]?JSON.stringify(h[a]):h[a],s+=a+"="+d+"&"}}o.send(s),o.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=e.response;console.log(t.currentTarget);var n={response:i,status:e._xhr.status,header:e.getAllResponseHeaders(),json:function(){return new Promise(function(t,e){return t(JSON.parse(i))})},text:function(){return new Promise(function(t,e){return t(i)})},blob:function(){return new Promise(function(t,e){var r=new Blob([JSON.stringify(JSON.parse(i),null,2)],{type:"application/json"});t(r)})}};r(n)},i)})}function addChildren(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e.forEach(function(e){t.addChild(e)})}function screenshot(t){var e=null;if(t instanceof egret.Texture&&(e=t),t instanceof egret.DisplayObject){var i=new egret.RenderTexture;i.drawToTexture(t),e=i}return{texture:e,toDataURL:function(t){void 0===t&&(t={});var i=t.area?new egret.Rectangle(t.area[0],t.area[1],t.area[2],t.area[3]):null;return e.toDataURL(t.format||"image/png",i)},toFile:function(t){void 0===t&&(t={});var i=t.area?new egret.Rectangle(t.area[0],t.area[1],t.area[2],t.area[3]):null;e.saveToFile(t.format,t.fileName||"download",i)}}}function loadImg(t){var e=this,i=new egret.ImageLoader;return new Promise(function(r,n){i.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=e.data,n=new egret.Bitmap(i);r(n)},e),i.load(t)})}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Component=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.center=function(t,e,i,r){return void 0===r&&(r={x:0,y:0}),t&&(this.x=(i.width-this.width)/2+r.x),e&&(this.y=(i.height-this.height)/2+r.y),this},e.prototype.disable=function(){return this.alpha=.5,this.touchEnabled=!1,this},e.prototype.enable=function(){return this.alpha=1,this.touchEnabled=!0,this},e.prototype.on=function(t,e,i){return this.touchEnabled=!0,this.addEventListener(t,e,i),this},e}(egret.Sprite);__reflect(Component.prototype,"Component");var View=function(t){function e(e){var i=t.call(this)||this;i.global=e,i.width=i.global.width,i.height=i.global.height,i.backBtn=new Button({width:60,height:60,x:10,y:10,background:Const.btnColor,text:{text:"<",style:{size:30}}}).on(egret.TouchEvent.TOUCH_END,function(t){i.global.main()},i),i.addChild(i.backBtn);var r=Draw.rect(null,{width:i.width,height:i.height}).brush({width:i.width,height:i.height,background:16777215});return i.addChildAt(r,0),i}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(View.prototype,"View");var RankView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.global=e,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=Draw.rect(null,{width:this.width,height:this.height}).brush({width:100,height:100,background:4278190080});this.addChild(t);var e=new Button({width:400,height:100,img:"btn",background:4408638,text:{text:"Rank",style:{size:50}}});this.addChild(e),e.update({width:400,height:100,img:"btn",text:{text:"开始游戏",style:{size:50}}}),e.on(egret.TouchEvent.TOUCH_END,function(t){console.log(e)},this),e.center(!0,!0,this)},e}(View);__reflect(RankView.prototype,"RankView");var Const=function(){function t(){}return t}();Const.gameName="Tenrun",Const.btnColor=11755561,Const.mainColor=15582561,__reflect(Const.prototype,"Const");var Input=function(t){function e(e){var i=t.call(this)||this;Object.assign(i,e);var r=e.inputStyle.width||400,n=e.inputStyle.height||40;return Array.isArray(e.padding)?(i.width=r+e.padding[1]+e.padding[3],i.height=n+e.padding[0]+e.padding[2]):(i.width=r+2*e.padding,i.height=n+2*e.padding),i.inputStyle=Object.assign({},e.inputStyle),i.addChild(i.createBg()),i.input=i.createInput(),i.addChild(i.input),i}return __extends(e,t),e.prototype.createInput=function(){var t=new egret.TextField,e=this.inputStyle,i={x:0,y:0};return Array.isArray(this.padding)?(i.x=this.padding[3],i.y=this.padding[0]):i.x=i.y=this.padding,console.log(i),Object.assign(t,{type:e.type||egret.TextFieldType.INPUT,width:e.width||400,height:e.height||40,x:i.x,y:i.y,textColor:e.textColor||4278190080}),t},e.prototype.createBg=function(){var t=Draw.rect(null,{width:this.width,height:this.height}).brush({background:this.background,width:this.width,height:this.height});return t},Object.defineProperty(e.prototype,"input",{get:function(){return this._input},set:function(t){this._input=t},enumerable:!0,configurable:!0}),e}(Component);__reflect(Input.prototype,"Input");var GameView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.horizontalLine=200,n.score=0,n.figurePoint={x:200,y:370},n.figureRectPoint={x:150,y:290},n.figureRectOffset={x:n.figurePoint.x-n.figureRectPoint.x,y:n.figurePoint.y-n.figureRectPoint.y},n.isFalling=!1,n.jumpCounter=-22,n.fallCounter=0,n.global=e,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=this;this.createLand(),this.addChild(this.land),this.createSand(),this.addChild(this.sand),this.loadFigure(),this.addChild(this.figure),this.addChild(this.figureRect),this.scoreText=new egret.TextField,this.scoreText.text=this.score+"",this.scoreText.textColor=Const.btnColor,this.scoreText.width=400,this.scoreText.size=40,this.scoreText.x=this.width-this.scoreText.width-20,this.scoreText.y=20,this.scoreText.textAlign=egret.HorizontalAlign.RIGHT,this.addChild(this.scoreText);var e=!1,i=setInterval(function(){e=t.hitTest(t.figureRect,t.obstacle),e&&(egret.Tween.removeAllTweens(),clearInterval(i),clearInterval(t.jumpTimer),clearInterval(t.fallTimer))},50);this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.jump,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.falling,this),this.touchEnabled=!0,this.createObstacle(),this.addChild(this.obstacle)},e.prototype.createSand=function(){var t=RES.getRes("sand_png"),e=RES.getRes("sand_json");this.sand=new particle.GravityParticleSystem(t,e),this.sand.x=-280},e.prototype.createLand=function(){this.land=Draw.rect(null,{width:this.width,height:this.horizontalLine,y:this.height-this.horizontalLine}).brush({width:this.width,height:this.horizontalLine,background:Const.mainColor})},e.prototype.createScore=function(){this.scoreText=Draw.text("0",{x:this.width-200,y:20,width:300,height:40,size:40,textAlign:egret.HorizontalAlign.RIGHT,textColor:Const.mainColor}),console.log(this.score)},e.prototype.loadFigure=function(){var t=RES.getRes("Tenrun_ske_json"),e=RES.getRes("tenrun"),i=RES.getRes("tenrun_texture"),r=new dragonBones.EgretFactory;r.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(t)),r.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,e)),this.figure=r.buildArmatureDisplay("Tenrun"),this.figure.x=this.figurePoint.x,this.figure.y=this.figurePoint.y,this.figure.scaleX=-.3,this.figure.scaleY=.3,this.figure.animation.timeScale=2,this.figure.animation.play("run",0),this.figureRect=Draw.rect(null,{x:this.figureRectPoint.x,y:this.figureRectPoint.y,width:100,height:160,alpha:.4}).brush({width:100,height:160,background:15658734})},e.prototype.jump=function(t){var e=this;this.isFalling||(this.figure.animation.gotoAndStop("run",1),this.jumpTimer=setInterval(function(){return 0===e.jumpCounter?(clearInterval(e.jumpTimer),void e.falling(t)):(e.figure.y=e.caculateHeight(e.jumpCounter++),void(e.figureRect.y=e.figure.y-e.figureRectOffset.y))},20))},e.prototype.falling=function(t){var e=this;clearInterval(this.jumpTimer),this.fallCounter=-this.jumpCounter,this.jumpCounter=-22,this.isFalling=!0,this.touchEnabled=!1,this.fallTimer=setInterval(function(){return e.fallCounter>=22?(e.fallCounter=0,e.isFalling=!1,e.touchEnabled=!0,clearInterval(e.fallTimer),e.figure.animation.play("run",0),e.sand.start(),void setTimeout(function(){e.sand.stop()},200)):(e.figure.y=e.caculateHeight(e.fallCounter++),void(e.figureRect.y=e.figure.y-e.figureRectOffset.y))},20)},e.prototype.caculateHeight=function(t){return.5*Math.pow(t,2)+150},e.prototype.createObstacle=function(){var t=this;this.obstacle?this.obstacle.x=this.width:this.obstacle=Draw.rect(null,{width:60,height:100,x:this.width,y:this.height-this.horizontalLine-80}).brush({width:60,height:100,background:Const.mainColor});var e=egret.Tween.get(this.obstacle);e.to({x:-100},2e3).call(function(){t.score+=100,t.scoreText.text=t.score+"",t.createObstacle()})},e.prototype.hitTest=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x,r.y=e.y,i.intersects(r)},e}(View);__reflect(GameView.prototype,"GameView");var Button=function(t){function e(e){var i=t.call(this)||this;return i.width=e.width||200,i.height=e.height||100,i.init(e),i.cacheAsBitmap=!0,i.disabled=!1,i}return __extends(e,t),e.prototype.init=function(t){this.addRect(t),t.img&&this.addImg(t),t.text&&this.addText(t)},e.prototype.addRect=function(t){var e=Draw.rect(null,{x:t.x||0,y:t.y||0,width:this.width,height:this.height,rotation:t.rotation||0}).brush({width:this.width||0,height:this.height||0,background:t.background||0});this.addChild(e)},e.prototype.addImg=function(t){var e=this.img=new egret.Bitmap;e.texture=RES.getRes(t.img),e.width=this.width,e.height=this.height,this.addChild(e)},e.prototype.addText=function(t){t.text.style=t.text.style||{};var e=this.text=Draw.text(t.text.text,{x:t.x||0,y:t.y||0,width:this.width,height:this.height,textColor:t.text.style.textColor||16777215,size:t.text.style.size||20,textAlign:egret.HorizontalAlign.CENTER,verticalAlign:egret.VerticalAlign.MIDDLE});e.cacheAsBitmap=!0,this.addChild(e)},e.prototype.update=function(t){return this.removeChildren(),this.init(t),this},e}(Component);__reflect(Button.prototype,"Button");var Brush=function(){function t(t,e){this.sprite=t,this.type=e}return t.prototype.brush=function(t){switch(this.type){case"rect":this.brushRect(t)}return this.sprite},t.prototype.brushRect=function(t){t.background&&this.sprite.graphics.beginFill(t.background),t.lineWidth&&t.lineColor&&this.sprite.graphics.lineStyle(t.lineWidth,t.lineColor),this.sprite.graphics.drawRect(t.x||0,t.y||0,t.width||0,t.height||0),this.sprite.graphics.endFill()},t}();__reflect(Brush.prototype,"Brush");var Draw=function(){function t(){}return t.rect=function(t,e){t=t||new egret.Sprite;var i={x:0,y:0,width:0,height:0,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,alpha:1};e.scrollRect&&(t.scrollRect=e.scrollRect,t.cacheAsBitmap=!0);var r=Object.assign(i,e);return Object.assign(t,r),new Brush(t,"rect")},t.circle=function(t){return void 0===t&&(t=new egret.Sprite),new Brush(t,"circle")},t.line=function(t){return void 0===t&&(t=new egret.Sprite),new Brush(t,"line")},t.text=function(t,e){void 0===e&&(e={});var i=new egret.TextField;"textFlow"in e&&(i.textFlow=e.textFlow),i.text=t;for(var r in e)i[r]=e[r];return i},t.container=function(){},t}();__reflect(Draw.prototype,"Draw");var StartView=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.global=e,n.removeChild(n.backBtn),n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("start_bg"),this.addChildAt(t,1);var e=egret.localStorage,i=e.getItem("username");this.btns=this.addBtns(),i?this.btns.forEach(function(t){t.enable()}):this.register()},e.prototype.addBtns=function(){var t=this,e=200,i=new Button({width:200,height:100,background:Const.btnColor,text:{text:"Start",style:{size:50}}}).on(egret.TouchEvent.TOUCH_END,function(e){t.global.game()},this).center(!0,!0,this,{x:0,y:e}).disable();this.addChild(i);var r=new Button({width:100,height:100,background:Const.btnColor,text:{text:"Rank",style:{size:30}}}).center(!0,!0,this,{x:-170,y:e}).disable();return this.addChild(r),[i,r]},e.prototype.register=function(){var t=this,e=Draw.rect(null,{width:this.width,height:this.height,alpha:.8}).brush({width:this.width,height:this.height,background:4278190080});this.addChild(e);var i;i=new Input({background:8930338,padding:20,inputStyle:{width:400,height:40,textColor:16777215}}).center(!0,!1,this),this.addChild(i);var r=new Button({width:200,height:80,background:11755561,y:80,text:{text:"Submit",style:{size:30}}}).on(egret.TouchEvent.TOUCH_END,function(n){localStorage.setItem("username",i.input.text),t.btns.forEach(function(t){t.enable()}),t.removeChild(r),t.removeChild(i),t.removeChild(e)},this).center(!0,!1,this,{x:0,y:0});this.addChild(r)},e}(View);__reflect(StartView.prototype,"StartView");var Mask=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(Mask.prototype,"Mask");var Loading=function(t){function e(e){var i=t.call(this)||this;return i.bgUrl="resource/assets/Artboard.png",i.global=e,i.createView(),i}return __extends(e,t),e.prototype.createView=function(){this.w=this.global.width,this.h=this.global.height,this.textField=new egret.TextField,this.textField.y=500,this.textField.textColor=3355443,this.textField.size=23,this.textField.width=this.w,this.textField.height=100,this.textField.fontFamily="Black",this.textField.textAlign="center",this.textField_power=new egret.TextField,this.textField_power.y=.9*this.h,this.textField_power.textColor=3355443,this.textField_power.width=this.w,this.textField_power.height=100,this.textField_power.size=20,this.textField_power.text="Powered by Egret Engine",this.textField_power.fontFamily="Black",this.textField_power.textAlign="center";var t=new egret.URLLoader;t.addEventListener(egret.Event.COMPLETE,this.onComplete,this),t.dataFormat=egret.URLLoaderDataFormat.TEXTURE,t.load(new egret.URLRequest(this.bgUrl)),this.bg=new egret.Bitmap,this.uiContainer=new egret.DisplayObjectContainer,this.addChild(this.uiContainer),this.addChildAt(this.bg,0),this.addChild(this.textField),this.addChild(this.textField_power)},e.prototype.onComplete=function(t){var e=t.target,i=e.data;e._request.url==this.bgUrl&&(this.bg.texture=i,this.bg.scaleX=this.w/640,this.bg.scaleY=this.h/960)},e.prototype.setProgress=function(t,e){var i=Math.floor(t/e*100);this.textField.text="游戏加载中…"+i+"%"},e.prototype.onLoadComplete=function(t,e){t.call(e)},e}(egret.Sprite);__reflect(Loading.prototype,"Loading");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.loadingView=new Loading(this),this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.main())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.main=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new StartView(this,this.width,this.height);this.addChild(t)},e.prototype.game=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new GameView(this,this.width,this.height);this.addChild(t)},e.prototype.rank=function(){this.clear(),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight;var t=new RankView(this,this.width,this.height);this.addChild(t)},e.prototype.clear=function(){this.removeChildren()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");