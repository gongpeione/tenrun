var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},BaseSprite=function(e){function t(){var t=e.call(this)||this;return t.loadingView=null,t.groupName="preload",t.loadConfigFile="resource/default.res.json",t.loadRelativePath="resource/",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){null==this.loadingView&&(this.loadingView=new LoadingUI,this.addChild(this.loadingView)),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(this.loadConfigFile,this.loadRelativePath)},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.groupName instanceof Array?(RES.createGroup("initLoad",this.groupName),RES.loadGroup("initLoad")):(RES.createGroup("initLoad",[this.groupName]),RES.loadGroup("initLoad"))},t.prototype.onResourceLoadComplete=function(e){"initLoad"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadingView&&(this.removeChild(this.loadingView),this.loadingView=null),this.MyScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"initLoad"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.MyScene=function(){},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},t}(egret.Sprite);__reflect(BaseSprite.prototype,"BaseSprite");var GuideBaseLayer=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t}(eui.UILayer);__reflect(GuideBaseLayer.prototype,"GuideBaseLayer");var GuideBaseSprite=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t}(BaseSprite);__reflect(GuideBaseSprite.prototype,"GuideBaseSprite");var GuideLayer=function(e){function t(){var t=e.apply(this,arguments)||this;return t._Guidecontainer=null,t._bgShape=null,t._GuideBitMaprender=null,t}return __extends(t,e),t.prototype.addGuide=function(e,t,a,i){if(void 0===t&&(t=1),void 0===a&&(a=egret.MainContext.instance.stage.stageWidth),void 0===i&&(i=egret.MainContext.instance.stage.stageHeight),null==this._Guidecontainer&&(this._Guidecontainer=new egret.DisplayObjectContainer),null==this._bgShape&&(this._bgShape=new egret.Shape,this._bgShape.graphics.beginFill(0,.8),this._bgShape.graphics.drawRect(0,0,a,i),this._bgShape.graphics.endFill(),this._Guidecontainer.addChild(this._bgShape)),1==t)this._Guidecontainer.addChild(e),this.addChild(this._Guidecontainer),this._Guidecontainer.touchEnabled=!0;else{this._Guidecontainer.addChild(e),e.blendMode=egret.BlendMode.ERASE;var r=new egret.RenderTexture;r.drawToTexture(this._Guidecontainer),this._GuideBitMaprender=new egret.Bitmap(r),this._GuideBitMaprender.touchEnabled=!0,this.addChild(this._GuideBitMaprender),this.addChild(e),e.$alpha=0,e.touchEnabled=!0}},t.prototype.addGuideArr=function(e,t,a,i){if(void 0===t&&(t=1),void 0===a&&(a=egret.MainContext.instance.stage.stageWidth),void 0===i&&(i=egret.MainContext.instance.stage.stageHeight),null==this._Guidecontainer&&(this._Guidecontainer=new egret.DisplayObjectContainer),null==this._bgShape&&(this._bgShape=new egret.Shape,this._bgShape.graphics.beginFill(0,.8),this._bgShape.graphics.drawRect(0,0,a,i),this._bgShape.graphics.endFill(),this._Guidecontainer.addChild(this._bgShape)),1==t){for(var r=0;r<e.length;r++)this._Guidecontainer.addChild(e[r]);this.addChild(this._Guidecontainer),this._Guidecontainer.touchEnabled=!0}else{for(var r=0;r<e.length;r++)this._Guidecontainer.addChild(e[r]),e[r].blendMode=egret.BlendMode.ERASE;var n=new egret.RenderTexture;n.drawToTexture(this._Guidecontainer),this._GuideBitMaprender=new egret.Bitmap(n),this._GuideBitMaprender.touchEnabled=!0,this.addChild(this._GuideBitMaprender);for(var r=0;r<e.length;r++)this.addChild(e[r]),e[r].$alpha=0,e[r].touchEnabled=!0}},t.prototype.removeGuide=function(){null!=this._Guidecontainer&&(this._Guidecontainer.removeChildren(),this._Guidecontainer=null),null!=this._bgShape&&(this._bgShape=null),null!=this._GuideBitMaprender&&(this.removeChild(this._GuideBitMaprender),this._GuideBitMaprender=null)},t}(GuideBaseLayer);__reflect(GuideLayer.prototype,"GuideLayer");var GuideSprite=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addGuide=function(e,t,a,i){if(void 0===t&&(t=1),void 0===a&&(a=egret.MainContext.instance.stage.stageWidth),void 0===i&&(i=egret.MainContext.instance.stage.stageHeight),this._Guidecontainer=new egret.DisplayObjectContainer,t){var r=new egret.Shape;r.graphics.beginFill(0,.8),r.graphics.drawRect(0,0,a,i),r.graphics.endFill(),this._Guidecontainer.addChild(r),this._Guidecontainer.addChild(e),this.addChild(this._Guidecontainer),this._Guidecontainer.touchEnabled=!0}else{var r=new egret.Shape;r.graphics.beginFill(0,.8),r.graphics.drawRect(0,0,a,i),r.graphics.endFill(),this._Guidecontainer.addChild(r),this._Guidecontainer.addChild(e),e.blendMode=egret.BlendMode.ERASE;var n=new egret.RenderTexture;n.drawToTexture(this._Guidecontainer);var s=new egret.Bitmap(n);s.touchEnabled=!0,this.addChild(s),this.addChild(e),e.$alpha=0,e.touchEnabled=!0}},t}(GuideBaseSprite);__reflect(GuideSprite.prototype,"GuideSprite");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var BasePlayer=function(e){function t(){var t=e.call(this)||this;return t.groupName="GameOne",t.loadConfigFile="resource/GameOnetView.res.json",t.loadRelativePath="resource/",t}return __extends(t,e),t.prototype.MyScene=function(){this.createBase()},t.prototype.createBase=function(e){void 0===e&&(e=0),this._actionArray=["stop","run","run2","squat","oneLegStand","oneLegStand2","float","pushUp"];var t=RES.getRes("skeleton_json"),a=RES.getRes("texture_json"),i=RES.getRes("texture_png");this._container=new egret.DisplayObjectContainer,this.addChild(this._container);var r=new dragonBones.EgretFactory;r.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(t)),r.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,a)),this._armature=r.buildArmature("Robot"),this._armatureDisplay=this._armature.getDisplay(),dragonBones.WorldClock.clock.add(this._armature),this._container.addChild(this._armatureDisplay),this._armatureDisplay.x=0,this._armatureDisplay.y=0,this._armature.animation.gotoAndPlay(this._actionArray[e]),egret.startTick(this.onTicker,this)},t.prototype.onTicker=function(e){this._time||(this._time=e);var t=e,a=t-this._time;return this._time=t,dragonBones.WorldClock.clock.advanceTime(a/1e3),!1},t}(BaseSprite);__reflect(BasePlayer.prototype,"BasePlayer");var Mecha=function(e){function t(){var t=e.call(this)||this;return t._isJumpingA=!1,t._isJumpingB=!1,t._isSquating=!1,t._isAttackingA=!1,t._isAttackingB=!1,t._weaponRIndex=0,t._weaponLIndex=0,t._faceDir=1,t._aimDir=0,t._moveDir=0,t._aimRadian=0,t._speedX=0,t._speedY=0,t._armature=null,t._armatureDisplay=null,t._weaponR=null,t._weaponL=null,t._aimState=null,t._walkState=null,t._attackState=null,t._target=new egret.Point,t._armature=Scene.GameOneView.instance.factory.buildArmature("mecha_1502b"),t._armatureDisplay=t._armature.display,t._armatureDisplay.x=.5*Scene.GameOneView.instance.stage.stageWidth,t._armatureDisplay.y=Scene.GameOneView.instance.stage.stageHeight-100,t._armatureDisplay.scaleX=t._armatureDisplay.scaleY=.5,t.addChild(t._armatureDisplay),dragonBones.WorldClock.clock.add(t._armature),t}return __extends(t,e),t.prototype.aim=function(e,t){0==this._aimDir&&(this._aimDir=10),this._target.setTo(e,t)},t.prototype.update=function(){this._updateAim()},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1);var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var a=0;a=this._aimRadian>0?-1:1,this._aimDir!=a&&(this._aimDir=a,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()}},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t}(BaseSprite);Mecha.NORMAL_ANIMATION_GROUP="normal",Mecha.AIM_ANIMATION_GROUP="aim",Mecha.ATTACK_ANIMATION_GROUP="attack",Mecha.JUMP_SPEED=20,Mecha.NORMALIZE_MOVE_SPEED=3.6,Mecha.MAX_MOVE_SPEED_FRONT=1.4*Mecha.NORMALIZE_MOVE_SPEED,Mecha.MAX_MOVE_SPEED_BACK=1*Mecha.NORMALIZE_MOVE_SPEED,Mecha.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],Mecha.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],Mecha._globalPoint=new egret.Point,__reflect(Mecha.prototype,"Mecha");var MechPlayer=function(e){function t(){var t=e.call(this)||this;t._isJumpingA=!1,t._isJumpingB=!1,t._isSquating=!1,t._isAttackingA=!1,t._isAttackingB=!1,t._weaponRIndex=0,t._weaponLIndex=0,t._faceDir=1,t._aimDir=0,t._moveDir=0,t._aimRadian=0,t._speedX=2,t._speedY=2,t._armature=null,t._armatureDisplay=null,t._weaponR=null,t._weaponL=null,t._aimState=null,t._walkState=null,t._attackState=null,t._target=new egret.Point;var a=RES.getRes("CoreElement_json"),i=RES.getRes("CoreElement_texture_1_json"),r=RES.getRes("CoreElement_texture_1_png"),n=new dragonBones.EgretFactory;n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(a)),n.addTextureAtlas(new dragonBones.EgretTextureAtlas(r,i)),t._armature=n.buildArmature("mecha_1502b"),t._armatureDisplay=t._armature.display,t._armatureDisplay.x=.5*Scene.GameOneView.instance.stage.stageWidth,t._armatureDisplay.y=Scene.GameOneView.instance.stage.stageHeight-100,t._armatureDisplay.scaleX=t._armatureDisplay.scaleY=.5,t.addChild(t._armatureDisplay),dragonBones.WorldClock.clock.add(t._armature);var s=new egret.Shape;return s.graphics.beginFill(0,1),s.graphics.drawCircle(0,0,10),s.graphics.endFill(),t._armatureDisplay.addChild(s),t._armatureDisplay._debugDraw(!0),t}return __extends(t,e),t.prototype.playAction=function(e){switch(e){case"walk":null==this._walkState&&(this._walkState=this._armature.animation.fadeIn(e,-1,-1,0,t.NORMAL_ANIMATION_GROUP))}},t.prototype.stopAction=function(e){switch(e){case"walk":this._walkState&&(this._walkState.stop(),this._walkState=null)}},t.prototype.move=function(e,t){switch(this._armatureDisplay.scaleX*t<0&&(this._armatureDisplay.scaleX*=-1),this.playAction("walk"),e){case 65:this._armatureDisplay.x-=this._speedX;break;case 68:this._armatureDisplay.x+=this._speedX}},t.prototype.aim=function(e,t){0==this._aimDir&&(this._aimDir=10),this._target.setTo(e,t)},t.prototype.update=function(){this._updateAim()},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1);var e=this._armature.getBone("weapon_l").global.y*this._armatureDisplay.scaleY,a=this._armature.getBone("weapon_l").global.x*this._armatureDisplay.scaleX;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x-a):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x-a),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,this._aimDir!=i&&(this._aimDir=i,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()}},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t.prototype.onFire=function(){var e=this._armature.getSlot("weapon_l").childArmature,a=e.getBone("firePoint");t.firePoint=e.display.localToGlobal(a.global.x,a.global.y,t.firePoint),t.firePoint.x+=2*Math.random()-1,t.firePoint.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,r=new Bullet("bullet_01","fireEffect_01",i+.02*Math.random()-.01,30,t.firePoint),n=this._armature.getSlot("weapon_r").childArmature,s=e.getBone("firePoint");t.firePoint=n.display.localToGlobal(s.global.x,s.global.y,t.firePoint),t.firePoint.x-=2*Math.random()-1,t.firePoint.y-=2*Math.random()-1;var o=new Bullet("bullet_01","fireEffect_01",i+.02*Math.random()-.01,30,t.firePoint);Scene.GameOneView.instance.addBullte(r),Scene.GameOneView.instance.addBullte(o)},t}(BaseSprite);MechPlayer.NORMAL_ANIMATION_GROUP="normal",MechPlayer.AIM_ANIMATION_GROUP="aim",MechPlayer.ATTACK_ANIMATION_GROUP="attack",MechPlayer.JUMP_SPEED=20,MechPlayer.NORMALIZE_MOVE_SPEED=3.6,MechPlayer.MAX_MOVE_SPEED_FRONT=1.4*MechPlayer.NORMALIZE_MOVE_SPEED,MechPlayer.MAX_MOVE_SPEED_BACK=1*MechPlayer.NORMALIZE_MOVE_SPEED,MechPlayer.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],MechPlayer.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],MechPlayer._globalPoint=new egret.Point,MechPlayer.firePoint=new egret.Point,__reflect(MechPlayer.prototype,"MechPlayer");var MechTestPlayer=function(e){function t(){var t=e.call(this)||this;t._isJumpingA=!1,t._isJumpingB=!1,t._isSquating=!1,t._isAttackingA=!1,t._isAttackingB=!1,t._weaponRIndex=0,t._weaponLIndex=0,t._faceDir=1,t._aimDir=0,t._moveDir=0,t._aimRadian=0,t._speedX=0,t._speedY=0,t._armature=null,t._armatureDisplay=null,t._weaponR=null,t._weaponL=null,t._aimState=null,t._walkState=null,t._attackState=null,t._target=new egret.Point;var a=RES.getRes("CoreElement_json"),i=RES.getRes("CoreElement_texture_1_json"),r=RES.getRes("CoreElement_texture_1_png"),n=new dragonBones.EgretFactory;return n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(a)),n.addTextureAtlas(new dragonBones.EgretTextureAtlas(r,i)),t._armature=n.buildArmature("mecha_1502b"),t._armatureDisplay=t._armature.display,t._armatureDisplay.x=.5*Scene.GameTestView.instance.stage.stageWidth,t._armatureDisplay.y=Scene.GameTestView.instance.stage.stageHeight-100,t._armatureDisplay.scaleX=t._armatureDisplay.scaleY=.5,Scene.GameTestView.instance.addChild(t._armatureDisplay),dragonBones.WorldClock.clock.add(t._armature),t}return __extends(t,e),t.prototype.playAction=function(e){switch(e){case"walk":null==this._walkState&&(this._walkState=this._armature.animation.fadeIn(e,-1,-1,0,t.NORMAL_ANIMATION_GROUP))}},t.prototype.stopAction=function(e){switch(e){case"walk":this._walkState&&(this._walkState.stop(),this._walkState=null)}},t.prototype.move=function(e){this._armatureDisplay.scaleX*e<0&&(this._armatureDisplay.scaleX*=-1),this.playAction("walk")},t.prototype.aim=function(e,t){0==this._aimDir&&(this._aimDir=10),this._target.setTo(e,t)},t.prototype.update=function(){this._updateAim()},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1);var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var a=0;a=this._aimRadian>0?-1:1,this._aimDir!=a&&(this._aimDir=a,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()}},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t.prototype.onFire=function(){var e=this._armature.getSlot("weapon_l").childArmature,a=e.getBone("firePoint");t.firePoint=e.display.localToGlobal(a.global.x,a.global.y,t.firePoint),t.firePoint.x+=2*Math.random()-1,t.firePoint.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,r=new TestBullet("bullet_01","fireEffect_01",i+.02*Math.random()-.01,40,t.firePoint);Scene.GameTestView.instance.addBullte(r)},t}(egret.DisplayObject);MechTestPlayer.NORMAL_ANIMATION_GROUP="normal",MechTestPlayer.AIM_ANIMATION_GROUP="aim",MechTestPlayer.ATTACK_ANIMATION_GROUP="attack",MechTestPlayer.JUMP_SPEED=20,MechTestPlayer.NORMALIZE_MOVE_SPEED=3.6,MechTestPlayer.MAX_MOVE_SPEED_FRONT=1.4*MechTestPlayer.NORMALIZE_MOVE_SPEED,MechTestPlayer.MAX_MOVE_SPEED_BACK=1*MechTestPlayer.NORMALIZE_MOVE_SPEED,MechTestPlayer.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],MechTestPlayer.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],MechTestPlayer._globalPoint=new egret.Point,MechTestPlayer.firePoint=new egret.Point,__reflect(MechTestPlayer.prototype,"MechTestPlayer");var Scene;!function(e){var t=function(e){function t(){var a=e.call(this)||this;return a.my_enemys=[],a._scoreValue=0,a._isLeft=!1,a._isRight=!1,a._bullets=[],a.enemy_bullets=[],a._helpPointA=new egret.Point,a._helpPointB=new egret.Point,a._helpPointD=new egret.Point,a.e_centerPos=new egret.Point,a.isAttack=!1,a._enemyPos=new egret.Point,t.instance=a,a.groupName=["GameOne","bar"],a.loadConfigFile="resource/GameOneView.res.json",a.loadRelativePath="resource/",a}return __extends(t,e),t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.MyScene=function(){this.createFactory(),this._bg=ResourceUtils.createBitmapByName("fight1BgImage"),this._bg.width=this.stage.stageWidth,this.addChild(this._bg),this.addSprite(),this.initMecha(),this.addChild(AlertPanel.i()),this._ball=new particle.GravityParticleSystem(RES.getRes("ball_png"),RES.getRes("ball_json")),this.addChild(this._ball)},t.prototype.initMecha=function(){this.stage.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchHandler,this),this.my_player=new MechPlayer,this.addChild(this.my_player),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler);for(var e=0;5>e;e++)this.my_enemys.push(new MechEnemy(.2*this.stage.stageWidth*e)),this.addChild(this.my_enemys[e])},t.prototype._keyHandler=function(e){var a="keydown"==e.type;t.instance&&(t.instance._keyCode=a?e.keyCode:0)},t.prototype.addBullte=function(e){this._bullets.push(e)},t.prototype.addEnemyBullte=function(e){this.enemy_bullets.push(e)},t.prototype.onEnterFrameHandler=function(e){this.my_player.update(),this.checkCollision();for(var t=this._bullets.length;t--;){var a=this._bullets[t];a.update()&&this._bullets.splice(t,1)}dragonBones.WorldClock.clock.advanceTime(-1)},t.prototype.checkCollision=function(){var e=this.my_enemys.length,t=Math.round(50*Math.random()-1);for(console.log("rand:"+t);e--;){var a=this.my_enemys[e];this.e_centerPos.x=a._armatureDisplay.x+a._armatureDisplay.width/2*a._armatureDisplay.scaleX,this.e_centerPos.y=a._armatureDisplay.y;var i=this.my_player._armature.intersectsSegment(this.e_centerPos.x-this.my_player._armatureDisplay.x,this.e_centerPos.y-this.my_player._armatureDisplay.y,this.e_centerPos.x-this.my_player._armatureDisplay.x,this.e_centerPos.y+1-this.my_player._armatureDisplay.y,this._helpPointA,this._helpPointB,this._helpPointD);i&&(console.log("碰到了"),egret.log("j:"+e),egret.log("e_centerPos:x: "+this.e_centerPos.x+"y: "+this.e_centerPos.y),egret.log("_helpPointA:x: "+this._helpPointA.x+"y: "+this._helpPointA.y),this._bar.current--,this._bar.current<=0&&(this.removeAllEvent(),AlertPanel.i().showErr("游戏结束\n分数："+10*this._scoreValue)),a._bar.current--),a._armatureDisplay.y>300&&e==t&&a.attack(),(a.update()||a._bar.current<=0||this.checkContainsPoint(a))&&this.my_enemys[e].recoveryAim()}switch(this._keyCode){case 65:this.my_player.move(65,-1);break;case 68:this.my_player.move(68,1);break;default:this.my_player.stopAction("walk")}},t.prototype.checkContainsPoint=function(e){for(var t=this._bullets.length;t--;){var a=this._bullets[t],i=a._armatureDisplay.width*Math.cos(a._radian),r=a._armatureDisplay.width*Math.sin(a._radian),n=new egret.Point(a._armatureDisplay.x-e._armatureDisplay.x,a._armatureDisplay.y-e._armatureDisplay.y),s=(new egret.Point(a._armatureDisplay.x-i-e._armatureDisplay.x,a._armatureDisplay.y-r-e._armatureDisplay.y),e._armature.containsPoint(n.y/.4,-n.x/.4));if(s)return egret.log("BoxDataobjname:"+s.name),this._bullets[t].isDie=!0,this._ball.emitterX=a._armatureDisplay.x,this._ball.emitterY=a._armatureDisplay.y,this._ball.start(1),e._bar.current-=1,e._bar.current<=0?(this._scoreLabel.text="分数:"+10*++this._scoreValue,!0):!1}return!1},t.prototype.onMouseMove=function(e,a,i){null!=t.instance.my_player&&t.instance.my_player.aim(e,a)},t.prototype.onTouchHandler=function(e){switch(this.my_player.aim(e.stageX,e.stageY),e.type){case egret.TouchEvent.TOUCH_BEGIN:this.my_player.update(),this.my_player.onFire();break;case egret.TouchEvent.TOUCH_END:}},t.prototype.onTicker=function(e){this._time||(this._time=e);var t=e,a=t-this._time;return this._time=t,dragonBones.WorldClock.clock.advanceTime(a/1e3),!1},t.prototype.addSprite=function(){var e=new eui.Button;e.width=220,e.height=60,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=this.$getWidth()-e.width/2,e.y=e.height/2,e.skinName="resource/eui_skins/ButtonSkin.exml",e.label="返回主菜单",this.addChild(e),e.touchEnabled=!0;var a=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(e,i,r){a.call(this,e,i,r),t.instance&&t.instance.my_player.aim(e,i)},e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.removeScene(),Game.GameViewManager.getInstance().showGame()},this);var i=new particle.GravityParticleSystem(RES.getRes("snowflake_png"),RES.getRes("snowflake_json"));this.addChild(i),i.start(),i.emitterX=0,i.emitterY=0,i.scaleX=i.scaleY=2,this._bar=new BoldBar,this.addChild(this._bar),this._bar.total=10,this._bar.current=10;var r=ResourceUtils.createBitmapByName("off_png");r.y=50,r.scaleX=r.scaleY=2.5,this.addChild(r),this._scoreLabel=new egret.TextField,this._scoreLabel.textColor=16777215,this._scoreLabel.width=2.5*r.width,this._scoreLabel.textAlign="center",this._scoreLabel.text="分数:0",this._scoreLabel.size=40,this._scoreLabel.y=50+r.height/2,this.addChild(this._scoreLabel);var n=new eui.Button;n.width=220,n.height=60,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=this.$getWidth()-n.width/2,n.y=100,n.skinName="resource/eui_skins/ButtonSkin.exml",n.label="截屏",this.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e=new egret.RenderTexture,t=new egret.Rectangle(0,0,640,1136);this.mask=t,e.drawToTexture(this,t),e.saveToFile("image/png","gameOne.png",t)},this)},t.prototype.createFactory=function(){var e=RES.getRes("CoreElement_json"),t=RES.getRes("CoreElement_texture_1_json"),a=RES.getRes("CoreElement_texture_1_png");this.factory=new dragonBones.EgretFactory,this.factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(e)),this.factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(a,t))},t.prototype.removeAllEvent=function(){egret.Tween.removeAllTweens(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchHandler,this),this.stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrameHandler,this)},t.prototype.removeScene=function(){if(this.removeAllEvent(),null!=t.instance){for(var e=0;e<this._bullets.length;e++)null!=this._bullets[e]&&(this._bullets[e].removeBullet(),this._bullets[e]=null);t.instance.removeChildren(),t.instance=null}return!0},t}(BaseSprite);e.GameOneView=t,__reflect(t.prototype,"Scene.GameOneView")}(Scene||(Scene={}));var Scene;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.groupName="snow",t.loadConfigFile="resource/snowflake.res.json",t.loadRelativePath="resource/",t}return __extends(t,e),t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.MyScene=function(){this._bg=ResourceUtils.createBitmapByName("fight1BgImage"),this._bg.x=(this.stage.stageWidth-this._bg.width)/2,this._bg.width=this.stage.stageWidth,this.addChild(this._bg),this._wallleft=ResourceUtils.createBitmapByName("wall1_2Image"),this.addChild(this._wallleft),this._wallRight=ResourceUtils.createBitmapByName("wall1_1Image"),this._wallRight.x=this.stage.stageWidth-this._wallRight.width,this.addChild(this._wallRight);var e=new particle.GravityParticleSystem(RES.getRes("snowflake_png"),RES.getRes("snowflake_json"));this.addChild(e),e.start(),e.emitterX=0,e.emitterY=0,e.scaleX=e.scaleY=2},t.removeScene=function(){return null!=t.instance&&(t.instance.removeChildren(),t.instance=null),!0},t}(BaseSprite);e.GameStartView=t,__reflect(t.prototype,"Scene.GameStartView")}(Scene||(Scene={}));var Scene;!function(e){var t=function(e){function t(){var a=e.call(this)||this;return a.my_enemys=[],a._isLeft=!1,a._isRight=!1,a._bullets=[],t.instance=a,a.groupName="GameOne",a.loadConfigFile="resource/GameOneView.res.json",a.loadRelativePath="resource/",a}return __extends(t,e),t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.MyScene=function(){var e=50;this._factor=50,this.createWorld(),this.createFactory(),this._bg=ResourceUtils.createBitmapByName("fight1BgImage"),this._bg.x=(this.stage.stageWidth-this._bg.width)/2,this._bg.width=this.stage.stageWidth,this.addChild(this._bg),this.createGround(),this.createPlayer(100,100,"redGirlHead_png"),this.createDebug(),egret.Ticker.getInstance().register(function(t){if(!(10>t||t>1e3)){this._world.step(t/1e3);for(var a=egret.MainContext.instance.stage.stageHeight,i=this._world.bodies.length,r=0;i>r;r++){var n=this._world.bodies[r];console.log("boxBody.x:"+n.position[0]+" boxBody.y: "+n.position[1]);var s=n.displays[0];s&&(s.x=n.position[0]*e,s.y=a-n.position[1]*e,s.rotation=360-180*(n.angle+n.shapes[0].angle)/Math.PI,s.alpha=1)}}},this),this._ball=new particle.GravityParticleSystem(RES.getRes("ball_png"),RES.getRes("ball_json")),this.addChild(this._ball)},t.prototype.createDebug=function(){var e=new egret.Sprite;this.addChild(e),this.debugDraw=new p2DebugDraw(this._world,e)},t.prototype._keyHandler=function(e){var a="keydown"==e.type;t.instance._keyCode=a?e.keyCode:0},t.prototype.addBullte=function(e){this._bullets.push(e)},t.prototype.onEnterFrameHandler=function(e){this._player.displays[0].update();for(var t=this.my_enemys.length;t--;){var a=this.my_enemys[t];a.update()&&(this.removeChild(this.my_enemys[t]),this.my_enemys.splice(t,1))}switch(this._keyCode){case 65:this._player.displays[0].move(-1);break;case 68:this._player.displays[0].move(1);break;default:this._player.displays[0].stopAction("walk")}for(var i=this._bullets.length;i--;){var r=this._bullets[i];r.update()&&this._bullets.splice(i,1)}dragonBones.WorldClock.clock.advanceTime(-1)},t.prototype.onMouseMove=function(e,a,i){t.instance._player.displays[0].aim(e,a)},t.prototype.onTouchHandler=function(e){switch(this._player.displays[0].aim(e.stageX,e.stageY),e.type){case egret.TouchEvent.TOUCH_BEGIN:this._player.displays[0].onFire();break;case egret.TouchEvent.TOUCH_END:console.log("stop")}},t.prototype.onTicker=function(e){this._time||(this._time=e);var t=e,a=t-this._time;return this._time=t,dragonBones.WorldClock.clock.advanceTime(a/1e3),!1},t.prototype.run=function(e){this._world.step(e/1e3);for(var t=egret.MainContext.instance.stage.stageHeight,a=this._world.bodies.length,i=0;a>i;i++){var r=this._world.bodies[i],n=r.displays[0];n&&(n.x=r.position[0],n.y=t-r.position[1],n.rotation=360-180*(r.angle+r.shapes[0].angle)/Math.PI,n.alpha=1)}},t.prototype.createWorld=function(){var e=new p2.World;this._world=e},t.prototype.createGround=function(){var e=new p2.Plane,t=new p2.Body;t.addShape(e),t.displays=[],this._world.addBody(t)},t.prototype.createPlayer=function(e,t,a){var i=Math.floor(this.stage.stageWidth/2/this._factor),r=Math.floor((egret.MainContext.instance.stage.stageHeight-100)/this._factor),n=new p2.Body({mass:1,position:[i,r]});this._world.addBody(n);var s=new p2.Box({width:.5*e/this._factor,height:.5*t/this._factor});n.addShape(s);var o=ResourceUtils.createBitmapByName(a);return o.width=e,o.height=t,o.anchorOffsetX=.5*o.width,o.anchorOffsetY=.5*o.height,n.displays=[o],this.addChild(o),n},t.prototype.createMechPlayer=function(){var e=new MechTestPlayer,t=e._armatureDisplay,a=Math.floor(this.stage.stageWidth/2/this._factor),i=Math.floor((egret.MainContext.instance.stage.stageHeight-1e3)/this._factor),r=new p2.Body({mass:1,position:[a,i]});this._world.addBody(r);var n=new p2.Box({width:t.width,height:t.height});return r.addShape(n),r.displays=[e],this.addChild(t),r},t.prototype.createFactory=function(){var e=RES.getRes("CoreElement_json"),t=RES.getRes("CoreElement_texture_1_json"),a=RES.getRes("CoreElement_texture_1_png");this.factory=new dragonBones.EgretFactory,this.factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(e)),this.factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(a,t))},t.removeScene=function(){return null!=t.instance&&(t.instance.removeChildren(),t.instance=null),!0},t}(BaseSprite);e.GameTestView=t,__reflect(t.prototype,"Scene.GameTestView")
}(Scene||(Scene={}));var Scene;!function(e){var t=function(e){function t(){var t=e.call(this)||this;t._source=["resource/assets/mask.png","resource/assets/start_btn.png","resource/assets/optionBgImage.png"],t._isbgSound=!0,t._isEffSound=!0,t._mainBox=new egret.Sprite,t.addChild(t._mainBox);var a=new egret.ImageLoader;a.once(egret.Event.COMPLETE,t.startCreateScene,t);for(var i=0;i<t._source.length;i++)a.load(t._source[i]);return t}return __extends(t,e),t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.removeScene=function(){return null!=t.instance&&(t.instance.removeChildren(),t.instance=null),!0},t.prototype.startCreateScene=function(){this._load_bg=new eui.Image,this._load_bg.source=this._source[0],this._load_bg.width=this.$getWidth(),this._load_bg.height=this.$getHeight(),this._mainBox.addChild(this._load_bg),this.createButton(),this._bgSound=new egret.Sound,this._bgSound.addEventListener(egret.Event.COMPLETE,function(e){this._bgSoundState=this._bgSound.play(),this._isbgSound||this._bgSoundState.stop()},this),this._bgSound.load("resource/assets/sound/sound_bg.mp3")},t.prototype.createButton=function(){this._btn=new eui.Image,this._btn.source=this._source[1],this._btn.x=this.$getWidth()/2-100,this._btn.y=this.$getHeight()/2,this._btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this,!1,99),this._mainBox.addChild(this._btn),this.guide_btn=new eui.Button,this.guide_btn.width=220,this.guide_btn.height=60,this.guide_btn.anchorOffsetX=this.guide_btn.width/2,this.guide_btn.anchorOffsetY=this.guide_btn.height/2,this.guide_btn.x=this.$getWidth()/2,this.guide_btn.y=this.$getHeight()/2-150,this.guide_btn.skinName="resource/eui_skins/ButtonSkin.exml",this.guide_btn.label="新手引导demo",this.addChild(this.guide_btn),this.guide_btn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchGuide,this);var e=new eui.Button;e.width=150,e.height=60,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=this.$getWidth()/2,e.y=this.$getHeight()/2-50,e.skinName="resource/eui_skins/ButtonSkin.exml",e.label="p2 demo",this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchGameOne,this);var t=new eui.Image;t.source="resource/assets/music_btn.png",t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=this.$getWidth()/2-160,t.y=this.$getHeight()/2,this.addChild(t);var a=new egret.Sprite;this.addChild(a);var i=new egret.Sprite;i.x=this.$getWidth()/4,i.y=this.$getHeight()/4,this.addChild(i);var r=new eui.Image;r.source="resource/assets/option_bg.png",r.x=this.$getWidth()/4,r.y=this.$getHeight()/4;var n=r.x+220,s=r.x+180,o=new eui.Image;o.source=this._isbgSound?"resource/assets/option_06.png":"resource/assets/option_05.png",o.x=this._isbgSound?n:s,o.y=368;var h=new eui.Image;h.source=this._isEffSound?"resource/assets/option_06.png":"resource/assets/option_05.png",h.x=this._isEffSound?n:s,h.y=430;var l=new eui.Image;l.source="resource/assets/option_07.png",l.x=r.x+300,l.y=260,o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this._isbgSound?(o.x=s,o.source="resource/assets/option_05.png",this._bgSoundState.stop()):(o.x=n,o.source="resource/assets/option_06.png",this._bgSoundState=this._bgSound.play()),this._isbgSound=this._isbgSound?!1:!0},this),h.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this._isEffSound=this._isEffSound?!1:!0,this._isEffSound?(h.x=n,h.source="resource/assets/option_06.png"):(h.x=s,h.source="resource/assets/option_05.png")},this),l.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.removeChildren()},this),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e=(.8*this._btn.width/2,.8*this._btn.height/2,egret.Tween.get(t));e.to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100),a.addChild(r),a.addChild(o),a.addChild(h),a.addChild(l)},this)},t.prototype.onTouchGuide=function(){this.createGuide()},t.prototype.onTouchGameOne=function(){Game.GameViewManager.getInstance().showGame(3)},t.prototype.createGuide=function(){var e=new egret.Shape;e.graphics.beginFill(0,1),e.graphics.drawCircle(0,0,120),e.graphics.endFill(),e.x=126,e.y=140,e.scaleY=.6,this.addGuide(this._btn)},t.prototype.onTouch=function(e){var t=(.8*this._btn.width/2,.8*this._btn.height/2,egret.Tween.get(this._btn));t.to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100).call(this.start,this)},t.prototype.onTouchGuideHandler=function(e){console.log("onTouchGuideHandler")},t.prototype.start=function(){Game.GameViewManager.getInstance().showGame(2)},t.prototype.removeAll=function(){this._mainBox.removeChildren()},t}(GuideLayer);e.SceneBegin=t,__reflect(t.prototype,"Scene.SceneBegin")}(Scene||(Scene={}));var BaseLayer=function(e){function t(){var t=e.call(this)||this;return t.groupName="preload",t.loadConfigFile="resource/default.res.json",t.loadRelativePath="resource/",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStageLadyer,t),t}return __extends(t,e),t.prototype.onAddToStageLadyer=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(this.loadConfigFile,this.loadRelativePath)},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup(this.groupName)},t.prototype.onResourceLoadComplete=function(e){e.groupName==this.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.MyScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){e.groupName==this.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.MyScene=function(){},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},t}(eui.UILayer);__reflect(BaseLayer.prototype,"BaseLayer");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){this.addChild(Game.GameViewManager.getInstance()),Game.GameViewManager.getInstance().showGame()},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},t.prototype.startAnimation=function(e){var t=this,a=new egret.HtmlTextParser,i=e.map(function(e){return a.parse(e)}),r=this.textfield,n=-1,s=function(){n++,n>=i.length&&(n=0);var e=i[n];r.textFlow=e;var a=egret.Tween.get(r);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(s,t)};s()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var AlertPanel=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initView=function(){this.initBG(),this.initBtn(),this.initTf(),this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height,this.x=this.stage.stageWidth/2,this.y=this.stage.stageHeight/2},t.prototype.initBG=function(){this._panelBg=new egret.Shape,this._panelBg.graphics.lineStyle(1,6710886,1),this._panelBg.graphics.beginFill(16777215,.9),this._panelBg.graphics.drawRect(0,0,300,200),this._panelBg.graphics.endFill(),this._panelBg.width=300,this._panelBg.height=200,this.addChild(this._panelBg)},t.prototype.initBtn=function(){this._btn=new egret.Shape,this._btn.graphics.lineStyle(1,6710886,1),this._btn.graphics.beginFill(16777215),this._btn.graphics.drawRect(0,0,80,40),this._btn.graphics.endFill(),this._btn.width=80,this._btn.height=40,this._btn.x=110,this._btn.y=140,this._btn.touchEnabled=!0,this._btn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickBtn,this),this.addChild(this._btn),this._btnLabel=new egret.TextField,this._btnLabel.size=20,this._btnLabel.textColor=3355443,this._btnLabel.text="确定",this._btnLabel.width=80,this._btnLabel.height=40,this._btnLabel.bold=!0,this._btnLabel.x=this._btn.x,this._btnLabel.y=this._btn.y,this._btnLabel.textAlign="center",this._btnLabel.verticalAlign="middle",this.addChild(this._btnLabel)},t.prototype.initTf=function(){this._msgTf=new egret.TextField,this._msgTf.textAlign="center",this._msgTf.verticalAlign="middle",this._msgTf.width=240,this._msgTf.height=100,this._msgTf.x=30,this._msgTf.y=20,this._msgTf.textColor=5592405,this._msgTf.size=25,this._msgTf.bold=!0,this.addChild(this._msgTf)},t.i=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.showErr=function(e){this.initView(),this._msgTf.text=e,egret.MainContext.instance.stage.addChild(this)},t.prototype.onClickBtn=function(){egret.RuntimeType.WEB==egret.Capabilities.runtimeType?this.reloadPage():this.hide()},t.prototype.reloadPage=function(){location.reload()},t.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);__reflect(AlertPanel.prototype,"AlertPanel");var BoldBar=function(e){function t(){var t=e.call(this)||this;return t.w=0,t.h=0,t.barBgBitMapName="blodBarBgImage",t.bloadBarBitMapName="blodBarImage",t.total=1,t.current=1,t.initView(),t}return __extends(t,e),t.prototype.initView=function(){var e=ResourceUtils.createBitmapByName(this.barBgBitMapName);this.addChild(e),this.blodBar=ResourceUtils.createBitmapByName(this.bloadBarBitMapName),this.addChild(this.blodBar),this.blodBar.x=38,this.blodBar.y=8,this.w=this.blodBar.width,this.h=this.blodBar.height,this.r=new egret.Rectangle,this.r.x=0,this.r.y=0,this.r.width=this.blodBar.width,this.r.height=this.blodBar.height,this.blodBar.mask=this.r,this.blodBar.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},t.prototype.update=function(){var e=this.w*(this.current/this.total);this.r=new egret.Rectangle,this.r.x=0,this.r.y=0,this.r.width=e,this.r.height=this.blodBar.height,this.blodBar.mask=this.r},t}(egret.Sprite);__reflect(BoldBar.prototype,"BoldBar");var Bullet_enemy=function(e){function t(t,a,i,r,n){var s=e.call(this)||this;if(s._speedX=0,s._speedY=0,s._radian=0,s.isDie=!1,s._armature=null,s._armatureDisplay=null,s._effect=null,s._speedX=Math.cos(i)*r,s._speedY=Math.sin(i)*r,s._radian=i,s._armature=Scene.GameOneView.instance.factory.buildArmature(t),s._armatureDisplay=s._armature.display,s._armatureDisplay.x=n.x,s._armatureDisplay.y=n.y,s._armatureDisplay.rotation=i*dragonBones.DragonBones.RADIAN_TO_ANGLE,s._armature.animation.play("idle"),s._maskIcon=new egret.Shape,s._maskIcon.graphics.beginFill(0,1),s._maskIcon.graphics.drawCircle(0,0,10),s._maskIcon.graphics.endFill(),a){s._effect=Scene.GameOneView.instance.factory.buildArmature(a);var o=s._effect.display;o.rotation=i*dragonBones.DragonBones.RADIAN_TO_ANGLE,o.x=n.x,o.y=n.y,o.scaleX=1+1*Math.random(),o.scaleY=1+.5*Math.random(),Math.random()<.5&&(o.scaleY*=-1),s._effect.animation.play("idle"),dragonBones.WorldClock.clock.add(s._effect),Scene.GameOneView.instance.addChild(o)}return dragonBones.WorldClock.clock.add(s._armature),Scene.GameOneView.instance.addChild(s._armatureDisplay),s}return __extends(t,e),t.prototype.update=function(){return this.isDie?(this.removeBullet(),!0):(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=Scene.GameOneView.instance.stage.stageWidth+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=Scene.GameOneView.instance.stage.stageHeight+100?(this.removeBullet(),!0):!1)},t.prototype.removeBullet=function(){return this._armatureDisplay&&(dragonBones.WorldClock.clock.remove(this._armature),Scene.GameOneView.instance.removeChild(this._armatureDisplay),this._armature.dispose(),this._armatureDisplay=null),this._effect&&(dragonBones.WorldClock.clock.remove(this._effect),Scene.GameOneView.instance.removeChild(this._effect.display),this._effect.dispose(),this._effect=null),!0},t}(egret.Sprite);__reflect(Bullet_enemy.prototype,"Bullet_enemy");var Bullet=function(e){function t(t,a,i,r,n){var s=e.call(this)||this;if(s._speedX=0,s._speedY=0,s._radian=0,s.isDie=!1,s._armature=null,s._armatureDisplay=null,s._effect=null,s._speedX=Math.cos(i)*r,s._speedY=Math.sin(i)*r,s._radian=i,s._armature=Scene.GameOneView.instance.factory.buildArmature(t),s._armatureDisplay=s._armature.display,s._armatureDisplay.x=n.x,s._armatureDisplay.y=n.y,s._armatureDisplay.rotation=i*dragonBones.DragonBones.RADIAN_TO_ANGLE,s._armature.animation.play("idle"),s._maskIcon=new egret.Shape,s._maskIcon.graphics.beginFill(0,1),s._maskIcon.graphics.drawCircle(0,0,10),s._maskIcon.graphics.endFill(),a){s._effect=Scene.GameOneView.instance.factory.buildArmature(a);var o=s._effect.display;o.rotation=i*dragonBones.DragonBones.RADIAN_TO_ANGLE,o.x=n.x,o.y=n.y,o.scaleX=1+1*Math.random(),o.scaleY=1+.5*Math.random(),Math.random()<.5&&(o.scaleY*=-1),s._effect.animation.play("idle"),dragonBones.WorldClock.clock.add(s._effect),Scene.GameOneView.instance.addChild(o)}return dragonBones.WorldClock.clock.add(s._armature),Scene.GameOneView.instance.addChild(s._armatureDisplay),s}return __extends(t,e),t.prototype.update=function(){return this.isDie?(this.removeBullet(),!0):(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=Scene.GameOneView.instance.stage.stageWidth+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=Scene.GameOneView.instance.stage.stageHeight+100?(this.removeBullet(),!0):!1)},t.prototype.removeBullet=function(){return this._armatureDisplay&&(dragonBones.WorldClock.clock.remove(this._armature),Scene.GameOneView.instance.removeChild(this._armatureDisplay),this._armature.dispose(),this._armatureDisplay=null),this._effect&&(dragonBones.WorldClock.clock.remove(this._effect),Scene.GameOneView.instance.removeChild(this._effect.display),this._effect.dispose(),this._effect=null),!0},t}(egret.Sprite);__reflect(Bullet.prototype,"Bullet");var GuideTest=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initGuide=function(e,t,a,i){void 0===t&&(t=egret.MainContext.instance.stage.stageWidth),void 0===a&&(a=egret.MainContext.instance.stage.stageHeight),void 0===i&&(i=1);var r=new egret.DisplayObjectContainer;if(i){var n=new egret.Shape;n.graphics.beginFill(0,.8),n.graphics.drawRect(0,0,t,a),n.graphics.endFill();var s=new egret.Bitmap;s.texture=s.texture,s.x=e.x,s.y=e.y,r.addChild(n),r.addChild(e),s.blendMode=egret.BlendMode.ERASE;var o=new egret.RenderTexture;o.drawToTexture(r);var h=new egret.Bitmap(o);h.touchEnabled=!0,this.addChild(h),this.addChild(e),e.$alpha=0,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._TouchMethodName,this._GameScene)}else{var n=new egret.Shape;n.graphics.beginFill(0,.8),n.graphics.drawRect(0,0,t,a),n.graphics.endFill(),r.addChild(n),r.addChild(e),e.blendMode=egret.BlendMode.ERASE;var o=new egret.RenderTexture;o.drawToTexture(r);var h=new egret.Bitmap(o);h.touchEnabled=!0,this.addChild(h),this.addChild(e),e.$alpha=0,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._TouchMethodName,this._GameScene)}},t.prototype.onTouchHandler=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:}},t}(GuideSprite);__reflect(GuideTest.prototype,"GuideTest");var Guide=function(e){function t(t,a,i,r,n){void 0===r&&(r=egret.MainContext.instance.stage.stageWidth),void 0===n&&(n=egret.MainContext.instance.stage.stageHeight);var s=e.call(this)||this;return s._GameScene=t,s._TouchMethodName=a,console.log("type:"+typeof i),null!=i.texture?s.init(t,i,r,n,1):s.init(t,i,r,n,0),s}return __extends(t,e),t.prototype.init=function(e,t,a,i,r){void 0===r&&(r=1);var n=new egret.DisplayObjectContainer;if(r){var s=new egret.Shape;s.graphics.beginFill(0,.8),s.graphics.drawRect(0,0,a,i),s.graphics.endFill();var o=new egret.Bitmap;o.texture=o.texture,o.x=t.x,o.y=t.y,n.addChild(s),n.addChild(t),o.blendMode=egret.BlendMode.ERASE;var h=new egret.RenderTexture;h.drawToTexture(n);var l=new egret.Bitmap(h);l.touchEnabled=!0,this.addChild(l),this.addChild(t),t.$alpha=0,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._TouchMethodName,this._GameScene)}else{var s=new egret.Shape;s.graphics.beginFill(0,.8),s.graphics.drawRect(0,0,a,i),s.graphics.endFill(),n.addChild(s),n.addChild(t),t.blendMode=egret.BlendMode.ERASE;var h=new egret.RenderTexture;h.drawToTexture(n);var l=new egret.Bitmap(h);l.touchEnabled=!0,this.addChild(l),this.addChild(t),t.$alpha=0,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._TouchMethodName,this._GameScene)}},t.prototype.onTouchHandler=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:}},t}(egret.DisplayObjectContainer);__reflect(Guide.prototype,"Guide");var BaseDisplay=function(e){function t(){var t=e.call(this)||this;return t.groupName="preload",t.loadConfigFile="resource/default.res.json",t.loadRelativePath="resource/",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(this.loadConfigFile,this.loadRelativePath)},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup(this.groupName)},t.prototype.onResourceLoadComplete=function(e){e.groupName==this.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.MyScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){e.groupName==this.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.MyScene=function(){},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},t}(egret.DisplayObjectContainer);__reflect(BaseDisplay.prototype,"BaseDisplay");var MechEnemy=function(e){function t(t,a){void 0===t&&(t=.5*Scene.GameOneView.instance.stage.stageWidth),void 0===a&&(a=0);var i=e.call(this)||this;i._isJumpingA=!1,i._isJumpingB=!1,i._isSquating=!1,i._isAttackingA=!1,i._isAttackingB=!1,i._weaponRIndex=0,i._weaponLIndex=0,i._faceDir=1,i._aimDir=0,i._moveDir=0,i._aimRadian=0,i._speedX=0,i._speedY=0,i._armature=null,i._armatureDisplay=null,i._weaponR=null,i._weaponL=null,i._aimState=null,i._walkState=null,i._attackState=null,i._target=new egret.Point,i._bullets=[],i._armature=Scene.GameOneView.instance.factory.buildArmature("mecha_1502b"),i._armatureDisplay=i._armature.getDisplay(),i._armatureDisplay.x=t,i._armatureDisplay.y=a,i._armatureDisplay.scaleX=i._armatureDisplay.scaleY=.4,i._armatureDisplay.rotation=90,i.addChild(i._armatureDisplay),dragonBones.WorldClock.clock.add(i._armature),i.move(1),i._armatureDisplay._debugDraw(!0);return i._bar=new BoldBar,i._bar.total=i._bar.current=2,i._bar.anchorOffsetX=i._bar.blodBar.width/2,i._bar.anchorOffsetY=i._bar.blodBar.height/2,i._bar.x=.4*-i._armatureDisplay.height,i._bar.y=.4*-i._armatureDisplay.width,i._bar.rotation=-90,i._bar.scaleX=.5,i._bar.scaleY=2,i._armatureDisplay.addChild(i._bar),i}return __extends(t,e),t.prototype.playAction=function(e){switch(e){case"walk":null==this._walkState&&(this._walkState=this._armature.animation.fadeIn(e,-1,-1,0,t.NORMAL_ANIMATION_GROUP))}},t.prototype.stopAction=function(e){switch(e){case"walk":this._walkState&&(this._walkState.stop(),this._walkState=null)}},t.prototype.move=function(e){this._armatureDisplay.scaleX*e<0&&(this._armatureDisplay.scaleX*=-1),this.playAction("walk")},t.prototype.aim=function(e,t){0==this._aimDir&&(this._aimDir=10),this._target.setTo(e,t)},t.prototype.update=function(){return this._bar.current<=0&&(this._armatureDisplay.y=-60,this._bar.current=this._bar.total),this.updateBullet(),this.checkContainsPoint(Scene.GameOneView.getInstance().my_player),this._armatureDisplay.y+=t.MAX_MOVE_SPEED_FRONT,this._armatureDisplay.y>1300?!0:!1},t.prototype.updateBullet=function(){for(var e=this._bullets.length;e--;){var t=this._bullets[e];t.update()&&this._bullets.splice(e,1)}},t.prototype.attack=function(){this.aim(Scene.GameOneView.getInstance().my_player._armatureDisplay.x,Scene.GameOneView.getInstance().my_player._armatureDisplay.y),this._updateAim(),this.onFire()},t.prototype.checkContainsPoint=function(e){for(var t=this._bullets.length;t--;){var a=this._bullets[t],i=a._armatureDisplay.width*Math.cos(a._radian),r=a._armatureDisplay.width*Math.sin(a._radian),n=new egret.Point(a._armatureDisplay.x-e._armatureDisplay.x,a._armatureDisplay.y-e._armatureDisplay.y),s=(new egret.Point(a._armatureDisplay.x-i-e._armatureDisplay.x,a._armatureDisplay.y-r-e._armatureDisplay.y),e._armature.containsPoint(n.y/.4,-n.x/.4));s&&--Scene.GameOneView.getInstance()._bar.current<=0&&(Scene.GameOneView.getInstance().removeAllEvent(),AlertPanel.i().showErr("游戏结束\n分数："+10*Scene.GameOneView.getInstance()._scoreValue),this.recoveryAim())}return!1},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.y>this._armatureDisplay.y?1:-1,this._armatureDisplay.scaleY*this._faceDir<0&&(this._armatureDisplay.scaleY*=-1);var e=this._armature.getBone("weapon_l").global.y*this._armatureDisplay.scaleY,a=this._armature.getBone("weapon_l").global.x*this._armatureDisplay.scaleX;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y+e,this._target.x-this._armatureDisplay.x-a):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y+e,this._target.x-this._armatureDisplay.x-a),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,this._aimDir!=i&&(this._aimDir=i,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs((this._aimRadian-Math.PI/2)/Math.PI*2),this._armature.invalidUpdate()}},t.prototype.recoveryAim=function(){this._armatureDisplay.y=-60,this._bar.current=this._bar.total,this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2),this._armatureDisplay.scaleY<0&&(this._armatureDisplay.scaleY*=-1),this._aimState.weight=0,this._armature.invalidUpdate()},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t.prototype.onFire=function(){var e=this._armature.getSlot("weapon_l").childArmature,a=e.getBone("firePoint");t.firePoint=e.display.localToGlobal(a.global.x,a.global.y,t.firePoint),t.firePoint.x+=2*Math.random()-1,t.firePoint.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,r=new Bullet("bullet_01","fireEffect_01",i+.02*Math.random()-.01,40,t.firePoint);this._bullets.push(r)},t.prototype.onDispose=function(){return this._armature?(dragonBones.WorldClock.clock.remove(this._armature),this.removeChild(this._armatureDisplay),this._armature.dispose(),!0):!1},t}(BaseSprite);MechEnemy.NORMAL_ANIMATION_GROUP="normal",MechEnemy.AIM_ANIMATION_GROUP="aim",MechEnemy.ATTACK_ANIMATION_GROUP="attack",MechEnemy.JUMP_SPEED=20,MechEnemy.NORMALIZE_MOVE_SPEED=3.6,MechEnemy.MAX_MOVE_SPEED_FRONT=1.4*MechEnemy.NORMALIZE_MOVE_SPEED,MechEnemy.MAX_MOVE_SPEED_BACK=1*MechEnemy.NORMALIZE_MOVE_SPEED,MechEnemy.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],MechEnemy.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],MechEnemy._globalPoint=new egret.Point,MechEnemy.firePoint=new egret.Point,__reflect(MechEnemy.prototype,"MechEnemy");var testEnemy=function(e){function t(t,a){void 0===t&&(t=.5*Scene.GameOneView.instance.stage.stageWidth),void 0===a&&(a=0);var i=e.call(this)||this;return i._isJumpingA=!1,i._isJumpingB=!1,i._isSquating=!1,i._isAttackingA=!1,i._isAttackingB=!1,i._weaponRIndex=0,i._weaponLIndex=0,i._faceDir=1,i._aimDir=0,i._moveDir=0,i._aimRadian=0,i._speedX=0,i._speedY=0,i._armature=null,i._armatureDisplay=null,i._weaponR=null,i._weaponL=null,i._aimState=null,i._walkState=null,i._attackState=null,i._target=new egret.Point,i._armature=Scene.GameOneView.instance.factory.buildArmature("mecha_1502b"),i._armatureDisplay=i._armature.getDisplay(),i._armatureDisplay.x=t,i._armatureDisplay.y=a,i._armatureDisplay.scaleX=i._armatureDisplay.scaleY=.4,i._armatureDisplay.rotation=90,dragonBones.WorldClock.clock.add(i._armature),i.move(1),i}return __extends(t,e),t.prototype.playAction=function(e){switch(e){case"walk":null==this._walkState&&(this._walkState=this._armature.animation.fadeIn(e,-1,-1,0,t.NORMAL_ANIMATION_GROUP))}},t.prototype.stopAction=function(e){switch(e){case"walk":this._walkState&&(this._walkState.stop(),this._walkState=null)}},t.prototype.move=function(e){this._armatureDisplay.scaleX*e<0&&(this._armatureDisplay.scaleX*=-1),this.playAction("walk")},t.prototype.aim=function(e,t){0==this._aimDir&&(this._aimDir=10),this._target.setTo(e,t)},t.prototype.update=function(){return!1},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1);var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var a=0;a=this._aimRadian>0?-1:1,this._aimDir!=a&&(this._aimDir=a,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()}},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t.prototype.onFire=function(){var e=this._armature.getSlot("weapon_l").childArmature,a=e.getBone("firePoint");t.firePoint=e.display.localToGlobal(a.global.x,a.global.y,t.firePoint),t.firePoint.x+=2*Math.random()-1,t.firePoint.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,r=new Bullet("bullet_01","fireEffect_01",i+.02*Math.random()-.01,40,t.firePoint);Scene.GameOneView.instance.addBullte(r)},t.prototype.onDispose=function(){return this._armature?(dragonBones.WorldClock.clock.remove(this._armature),this.removeChild(this._armatureDisplay),this._armature.dispose(),!0):!1},t}(BaseSprite);testEnemy.NORMAL_ANIMATION_GROUP="normal",testEnemy.AIM_ANIMATION_GROUP="aim",testEnemy.ATTACK_ANIMATION_GROUP="attack",testEnemy.JUMP_SPEED=20,testEnemy.NORMALIZE_MOVE_SPEED=3.6,testEnemy.MAX_MOVE_SPEED_FRONT=1.4*testEnemy.NORMALIZE_MOVE_SPEED,testEnemy.MAX_MOVE_SPEED_BACK=1*testEnemy.NORMALIZE_MOVE_SPEED,testEnemy.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],testEnemy.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],testEnemy._globalPoint=new egret.Point,testEnemy.firePoint=new egret.Point,__reflect(testEnemy.prototype,"testEnemy");var Game;!function(e){var t=function(e){function t(){var a=e.call(this)||this;return t.instance=a,a._mainBox=new egret.Sprite,a.addChild(a._mainBox),a}return __extends(t,e),t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.showGame=function(e){switch(void 0===e&&(e=0),e){case 0:this.removeAll(),this._mainBox.addChild(Scene.SceneBegin.getInstance());break;case 1:this.removeAll(),this._mainBox.addChild(Scene.GameStartView.getInstance());break;case 2:this.removeAll(),this._mainBox.addChild(Scene.GameOneView.getInstance());break;case 3:this.removeAll(),this._mainBox.addChild(new Scene.GameTestView)}},t.prototype.removeAll=function(){this._mainBox.removeChildren()},t}(egret.Sprite);e.GameViewManager=t,__reflect(t.prototype,"Game.GameViewManager")}(Game||(Game={}));var p2DebugDraw=function(){function e(e,t){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.factor=30,this.world=e,this.sprite=t}return e.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var e=this.world.bodies.length,t=0;e>t;t++)for(var a=this.world.bodies[t],i=0;i<a.shapes.length;i++){var r=a.shapes[i];
this.drawShape(r,a),this.isDrawAABB&&this.drawAABB(a)}e=this.world.constraints.length;for(var n,i=0;e>i;i++)switch(n=this.world.constraints[i],n.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(n);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(n);break;case p2.Constraint.GEAR:this.drawGearJoint(n);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(n);break;case p2.Constraint.LOCK:this.drawLockJoint(n)}e=this.world.springs.length;for(var s,o=0;e>o;o++)s=this.world.springs[o],s instanceof p2.LinearSpring?this.drawLinearSpring(s):s instanceof p2.RotationalSpring&&this.drawRotationalSpring(s)},e.prototype.drawAABB=function(e){var t=new Array,a=e.aabb.lowerBound[0],i=e.aabb.lowerBound[1],r=e.aabb.upperBound[0],n=e.aabb.upperBound[1];isFinite(a)&&isFinite(i)&&isFinite(r)&&isFinite(n)&&(t.push([a,i],[r,i],[r,n],[a,n]),this.drawConvex(t,this.COLOR_S,1,!1))},e.prototype.drawDistanceJoint=function(e){var t,a=new Array,i=new Array;t=e.distance,e.upperLimitEnabled&&e.upperLimit>t&&(t=e.upperLimit),e.bodyA.toWorldFrame(a,e.localAnchorA),e.bodyB.toWorldFrame(i,e.localAnchorB);var r=p2.vec2.subtract([],i,a);p2.vec2.normalize(r,r),p2.vec2.scale(r,r,t);var n=p2.vec2.add([],a,r);this.drawSegment(a,e.bodyA.position,this.COLOR_S),this.drawSegment(i,e.bodyB.position,this.COLOR_S),this.drawVecAt(r,a,this.COLOR_BLACK),e.position>t&&this.drawSegment(i,n,this.COLOR_RED),this.drawCircle(a,3/this.factor,this.COLOR_BLACK),this.drawCircle(n,3/this.factor,this.COLOR_BLACK),e.lowerLimitEnabled&&(p2.vec2.normalize(r,r),p2.vec2.scale(r,r,e.lowerLimit),n=p2.vec2.add([],a,r),this.drawCircle(n,2/this.factor,this.COLOR_BLACK))},e.prototype.drawRevoluteJoint=function(e){var t=new Array,a=new Array;e.bodyA.toWorldFrame(t,e.pivotA),e.bodyB.toWorldFrame(a,e.pivotB),this.drawSegment(e.bodyA.position,t,this.COLOR_S),this.drawSegment(e.bodyB.position,a,this.COLOR_S),this.drawSegment(t,a,this.COLOR_RED),this.drawCircle(t,3/this.factor,this.COLOR_BLACK)},e.prototype.drawGearJoint=function(e){var t=e.bodyA.position,a=e.bodyB.position,i=new Array,r=new Array;e.bodyA.toWorldFrame(i,[20/this.factor,0]),e.bodyB.toWorldFrame(r,[20/this.factor,0]);var n=p2.vec2.subtract([],t,i),s=p2.vec2.subtract([],a,r);this.drawVecAt(n,t,this.COLOR_BLACK,!0),this.drawVecAt(s,a,this.COLOR_BLACK,!0),e.bodyB.toWorldFrame(s,[10*(e.bodyB.angle-e.bodyA.angle-e.angle)/this.factor,0]),this.drawSegment(s,a,this.COLOR_RED)},e.prototype.drawPrismaticJoint=function(e){var t=(e.bodyA.position,e.bodyB.position,new Array),a=new Array;e.bodyA.toWorldFrame(t,e.localAnchorA),e.bodyB.toWorldFrame(a,e.localAnchorB);var i=new Array;i=this.toWorldVector(e.localAxisA,e.bodyA);var r=p2.vec2.copy([],i),n=p2.vec2.copy([],i);e.lowerLimitEnabled?p2.vec2.scale(r,i,e.lowerLimit):p2.vec2.scale(r,i,5e3),e.upperLimitEnabled?p2.vec2.scale(n,i,e.upperLimit):p2.vec2.scale(n,i,5e3),this.drawVecAt(r,t,this.COLOR_BLACK,!0),this.drawVecAt(n,t,this.COLOR_BLACK,!0),p2.vec2.add(r,r,t),this.drawCircle(r,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(n,n,t),this.drawCircle(n,2/this.factor,this.COLOR_BLACK,1,!0)},e.prototype.drawLockJoint=function(e){var t=new Array;new Array;e.bodyA.toWorldFrame(t,e.localOffsetB),this.drawSegment(t,e.bodyA.position,this.COLOR_S),this.drawSegment(t,e.bodyB.position,this.COLOR_RED),this.drawCircle(t,3/this.factor,this.COLOR_BLACK);var a=new Array;e.bodyA.toWorldFrame(a,[20/this.factor,0]),this.drawSegment(a,e.bodyA.position,this.COLOR_BLACK),e.bodyB.toWorldFrame(a,[20/this.factor,0]),this.drawSegment(a,e.bodyB.position,this.COLOR_BLACK)},e.prototype.drawLinearSpring=function(e){var t=new Array,a=new Array;e.bodyA.toWorldFrame(t,e.localAnchorA),e.bodyB.toWorldFrame(a,e.localAnchorB);var i=p2.vec2.subtract([],a,t);p2.vec2.normalize(i,i),p2.vec2.scale(i,i,e.restLength);var r=p2.vec2.add([],e.bodyA.position,i);this.drawSegment(r,e.bodyB.position,this.COLOR_RED),this.drawVecAt(i,t,this.COLOR_BLACK),this.drawCircle(t,3/this.factor,this.COLOR_RED),this.drawCircle(r,3/this.factor,this.COLOR_RED)},e.prototype.drawRotationalSpring=function(e){var t=new Array,a=new Array;t=e.bodyA.position,a=e.bodyB.position;var i=new Array,r=new Array;e.bodyA.toWorldFrame(i,[20/this.factor,0]),e.bodyB.toWorldFrame(r,[10*(e.bodyB.angle-e.bodyA.angle-e.restAngle+2)/this.factor,0]);var n=p2.vec2.subtract([],i,t),s=p2.vec2.subtract([],r,a);this.drawVecAt(n,t,this.COLOR_RED,!0),this.drawVecAt(s,a,this.COLOR_RED,!0),e.bodyB.toWorldFrame(r,[20/this.factor,0]),this.drawCircle(i,2/this.factor,this.COLOR_RED),this.drawCircle(r,2/this.factor,this.COLOR_RED)},e.prototype.drawShape=function(e,t,a,i){var a=void 0==a?this.getColor(t):a,i=void 0==i?!0:i;e instanceof p2.Convex?this.drawConvexShape(e,t,a,i):e instanceof p2.Plane?this.drawPlaneShape(e,t,a,i):e instanceof p2.Circle?this.drawCircleShape(e,t,a,i):e instanceof p2.Capsule?this.drawCapsule(e,t,a):e instanceof p2.Particle?this.drawParticle(e,t,a):e instanceof p2.Line?this.drawLine(e,t,a):e instanceof p2.Heightfield&&this.drawHeightfeild(e,t,a)},e.prototype.drawConvexShape=function(e,t,a,i){var r=(t.shapes.indexOf(e),e.position),n=e.angle,s=[],o=this.transformVec(e.vertices[0],r,n);t.toWorldFrame(s,r),t.toWorldFrame(o,o),this.drawSegment(s,o,a);for(var h=new Array,l=e.vertices.length,d=0;l>d;d++)o=this.transformVec(e.vertices[d],r,n),t.toWorldFrame(o,o),h.push(o);this.drawConvex(h,a,.5,i)},e.prototype.drawParticle=function(e,t,a){this.drawCircle(t.position,1/this.factor,a,.5),this.drawCircle(t.position,5/this.factor,a,1,!1)},e.prototype.drawLine=function(e,t,a){var i=e.length,r=new Array,n=new Array;t.toWorldFrame(r,[-i/2,0]),t.toWorldFrame(n,[i/2,0]),this.drawSegment(r,n,a)},e.prototype.drawHeightfeild=function(e,t,a){var i=this.sprite.graphics;i.lineStyle(1,a),i.beginFill(a,.5);var r,n=e.heights,s=e.elementWidth,o=new Array,h=new Array;n.forEach(function(e,a){r=a*s,o=new Array,t.toWorldFrame(o,[r,e]),h.push(o)}),o=new Array,t.toWorldFrame(o,[r,-500]),h.push(o),o=new Array,t.toWorldFrame(o,[0,-500]),h.push(o),o=new Array,t.toWorldFrame(o,[0,0]),h.push(o),this.drawConvex(h,a,.5)},e.prototype.drawCapsule=function(e,t,a){var i=e.length,r=e.radius,n=new Array,s=new Array,o=new Array,h=new Array,l=new Array,d=new Array;t.toWorldFrame(n,[-i/2,-r]),t.toWorldFrame(s,[i/2,-r]),t.toWorldFrame(o,[i/2,r]),t.toWorldFrame(h,[-i/2,r]),t.toWorldFrame(l,[i/2,0]),t.toWorldFrame(d,[-i/2,0]),this.drawCircle(l,r,a,.5),this.drawCircle(d,r,a,.5),this.drawConvex([n,s,o,h],a,.5)},e.prototype.drawCircleShape=function(e,t,a,i){var r=e.position,n=e.angle,s=new Array;t.toWorldFrame(s,r),this.drawCircle(s,e.radius,a,.5,i);var o=this.transformVec([e.radius,0],r,n);t.toWorldFrame(o,o),this.drawSegment(s,o,a)},e.prototype.drawPlaneShape=function(e,t,a,i){var r=new Array,n=new Array;t.shapes.indexOf(e);t.toWorldFrame(r,[1e3,0]),r=this.transformVec(r,e.position,e.angle),n.push(r),r=new Array,t.toWorldFrame(r,[1e3,-1e5]),r=this.transformVec(r,e.position,e.angle),n.push(r),r=new Array,t.toWorldFrame(r,[-1e3,-1e5]),r=this.transformVec(r,e.position,e.angle),n.push(r),r=new Array,t.toWorldFrame(r,[-1e3,0]),r=this.transformVec(r,e.position,e.angle),n.push(r),this.drawConvex(n,a,.5,i)},e.prototype.getColor=function(e){var t=this.COLOR_D_SLEEP;return e.type==p2.Body.KINEMATIC?t=this.COLOR_K:e.type==p2.Body.STATIC?t=this.COLOR_S:e.sleepState==p2.Body.AWAKE&&(t=this.COLOR_D_WAKE),t},e.prototype.drawVecAt=function(e,t,a,i){void 0===i&&(i=!1);var r=p2.vec2.copy([],t),n=p2.vec2.add([],e,t);i&&this.drawCircle(r,3/this.factor,a),this.drawSegment(r,n,a)},e.prototype.drawVecTo=function(e,t,a,i){void 0===i&&(i=!1);var r=p2.vec2.copy([],t),n=p2.vec2.subtract([],t,e);i&&this.drawCircle(r,3/this.factor,a),this.drawSegment(r,n,a)},e.prototype.drawSegment=function(e,t,a){this.sprite.graphics.lineStyle(1,a),this.sprite.graphics.moveTo(e[0]*this.factor,e[1]*this.factor),this.sprite.graphics.lineTo(t[0]*this.factor,t[1]*this.factor)},e.prototype.drawCircle=function(e,t,a,i,r){void 0===i&&(i=1),this.sprite.graphics.lineStyle(1,a),(r||void 0==r)&&this.sprite.graphics.beginFill(a,i),this.sprite.graphics.drawCircle(e[0]*this.factor,e[1]*this.factor,t*this.factor),this.sprite.graphics.endFill()},e.prototype.drawConvex=function(e,t,a,i){void 0===a&&(a=1),void 0===i&&(i=!0),this.sprite.graphics.lineStyle(1,t),i&&this.sprite.graphics.beginFill(t,a);var r=e.length,n=e[0];this.sprite.graphics.moveTo(n[0]*this.factor,n[1]*this.factor);for(var s=1;r>=s;s++)n=e[s%r],this.sprite.graphics.lineTo(n[0]*this.factor,n[1]*this.factor);this.sprite.graphics.endFill()},e.prototype.toWorldVector=function(e,t){var a=new Array;return p2.vec2.rotate(a,e,t.angle),a},e.prototype.transformVec=function(e,t,a){var i=new Array;return p2.vec2.rotate(i,e,a),p2.vec2.add(i,i,t),i},e.prototype.drawDotLine=function(e,t,a,i){if(void 0===t&&(t=0),void 0===a&&(a=!1),void 0===i&&(i=30),!(e.length<2)){var r=2/this.factor,n=[];p2.vec2.copy(n,e[0]),this.drawCircle(n,r,t,1,!1);for(var s=0;s<e.length-2;s++){var o=e[s];if(a)for(var h=p2.vec2.distance(n,o);h>i/this.factor;){var l=[];p2.vec2.subtract(l,o,n),p2.vec2.scale(l,l,i/this.factor/h),p2.vec2.add(n,n,l),this.drawCircle(n,r,t,1,!1),h=p2.vec2.distance(n,o)}else this.drawCircle(o,r,t,1,!1)}}},e}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");var ResourceUtils=function(){function e(){}return e.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},e.createBitmapFromSheet=function(e,t){void 0===t&&(t="gameRes");var a=RES.getRes(t),i=a.getTexture(e),r=new egret.Bitmap;return r.texture=i,r},e.getTextureFromSheet=function(e,t){void 0===t&&(t="gameRes");var a=RES.getRes(t),i=a.getTexture(e);return i},e}();__reflect(ResourceUtils.prototype,"ResourceUtils");var TestBullet=function(){function e(e,t,a,i,r){if(this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._effect=null,this._speedX=Math.cos(a)*i,this._speedY=Math.sin(a)*i,this._armature=Scene.GameTestView.instance.factory.buildArmature(e),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=r.x,this._armatureDisplay.y=r.y,this._armatureDisplay.rotation=a*dragonBones.DragonBones.RADIAN_TO_ANGLE,this._armature.animation.play("idle"),t){this._effect=Scene.GameTestView.instance.factory.buildArmature(t);var n=this._effect.display;n.rotation=a*dragonBones.DragonBones.RADIAN_TO_ANGLE,n.x=r.x,n.y=r.y,n.scaleX=1+1*Math.random(),n.scaleY=1+.5*Math.random(),Math.random()<.5&&(n.scaleY*=-1),this._effect.animation.play("idle"),dragonBones.WorldClock.clock.add(this._effect),Scene.GameTestView.instance.addChild(n)}dragonBones.WorldClock.clock.add(this._armature),Scene.GameTestView.instance.addChild(this._armatureDisplay)}return e.prototype.update=function(){return this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=Scene.GameTestView.instance.stage.stageWidth+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=Scene.GameTestView.instance.stage.stageHeight+100?(dragonBones.WorldClock.clock.remove(this._armature),Scene.GameTestView.instance.removeChild(this._armatureDisplay),this._armature.dispose(),this._effect&&(dragonBones.WorldClock.clock.remove(this._effect),Scene.GameTestView.instance.removeChild(this._effect.display),this._effect.dispose()),!0):!1},e}();__reflect(TestBullet.prototype,"TestBullet");